<!DOCTYPE HTML>
<html lang="en" class="navy sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Veraison Project</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./mdbook-admonish.css">
        <link rel="stylesheet" href="theme/pagetoc.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Veraison Project</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<p><img src="images/veraison-logo.svg" width="600px" class="center"
style="padding: 20px"></p>
<p>Project Veraison (<strong>VER</strong>ific<strong>A</strong>t<strong>I</strong>on of atte<strong>S</strong>tati<strong>ON</strong>) builds
software components that can be used to build an Attestation Verification
Service.</p>
<h2 id="background"><a class="header" href="#background">Background</a></h2>
<p>Attestation is the system by which an entity produces evidence about itself
that another party can use to evaluate the trustworthiness of that entity. A
critical part of establishing trust based on that evidence is Verifying what is
presented to ensure it meets a policy established to prove trustworthiness. The
act of Verification will often require comparing evidence against reference
values or checking cryptographic signatures from a known trust anchor. This is
a complex task to be performed by an arbitrary user of a system and it is often
delegated to a trusted Verification Service instead. The nature of the Service
will depend upon the deployment - it may be a local software component or it
may reside as a network or internet accessible component. The Verification
Service will need up to date data for the process of appraising the evidence
presented to it. This must be obtained from authoritative sources, which
normally implies establishing business relationships between the Verification
Service and those sources.</p>
<h2 id="what-part-does-veraison-play-in-this"><a class="header" href="#what-part-does-veraison-play-in-this">What part does Veraison play in this?</a></h2>
<p>Given the above, it can be challenging to build just one Verification Service
solution which can address all deployments for a technology that needs to
produce Attestation reports to prove its trustworthiness. If that then implies
that each deployment needs a custom service, there is a significant software
barrier and hence cost of entry to establishing a system that can be used in a
secure manner. Veraison aims to provide consistency and convenience to solving
this problem by building the software components that can be used to build
Attestation Verification Services. The components encompass a core structure of
verification and provisioning pipelines that can be extended to support
specific attestation technologies by the use of plugins. The core components
relate to the deployment environment via abstractions.The Veraison project will
build some reference implementations in order to prove the integration
principles of those components. The reference implementations will not be
production quality, but may provide a convenient basis for substantive
deployments.</p>
<h2 id="why-veraison"><a class="header" href="#why-veraison">Why "Veraison"?</a></h2>
<p>Veraison (pronunciation "ver-ayy-sjon") is a term used in winemaking to
indicate the point at which grapes start to ripen. It was chosen for this
project mainly because it could fit into the project intent (verification of
attestation) and because it didn't clash with any other project name. There is
also an allegorical aspect about good/bad verifications being reflected by ripe
/ unripe states or even common uses of green / red colours, but musing on such
interpretations is left to the reader!</p>
<h2 id="feedback"><a class="header" href="#feedback">Feedback</a></h2>
<p>Source code for this book is located on <a href="https://github.com/veraison/book">GitHub</a>.
Please submit any feedback via issues or updates via pull requests there.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<p>This is an overview of the major components that par part of Veraison, and the
related git repositories.</p>
<h2 id="remote-attestation-verification-service"><a class="header" href="#remote-attestation-verification-service">Remote attestation verification service</a></h2>
<p>The main part of the project is the remote attestation verification service
implemented inside <a href="https://github.com/veraison/services">services</a> repo. This
service provides REST API for verifying attestation evidence based on
provisioned endorsements and polices.</p>
<p>Client-side libraries for the services API are inside
<a href="https://github.com/veraison/apiclient">apiclient</a> (for Go),
<a href="https://github.com/veraison/c-apiclient">c-apiclient</a> (for C), and
<a href="https://github.com/veraison/rust-apiclient">rust-apiclient</a> (for Rust) repos.</p>
<p>There are also command line interface application for interacting with the
service:</p>
<ul>
<li><a href="https://github.com/veraison/cocli">cocli</a> for compiling and provisioning PSA
and CCA endorsements and trust anchors.</li>
<li><a href="https://github.com/veraison/evcli">evcli</a> for verifying PSA and CCA evidence.</li>
<li><a href="https://github.com/veraison/pocli">pocli</a> for managing verification
policies.</li>
</ul>
<h2 id="standards-driven-work"><a class="header" href="#standards-driven-work">Standards driven work</a></h2>
<p>The Veraison Project supports Attestation related working groups in standards bodies, in particular IETF &amp; TCG. This set of repos provide test bed implementations for some of the standards work, as related to Veraison services.</p>
<h4 id="eat"><a class="header" href="#eat">EAT</a></h4>
<p><a href="https://github.com/veraison/eat">eat</a>
Golang library for manipulating Entity Attestation Tokens (draft-ietf-rats-eat).</p>
<h4 id="ear"><a class="header" href="#ear">EAR</a></h4>
<p>These libraries provide functions for working with EAR (EAT Attestation Results), an EAT/JWT serialisation of the Attestation Result for Secure Interactions (AR4SI) information model - see draft-fv-rats-ear</p>
<p><a href="https://github.com/veraison/ear">ear</a>: Golang implementation of EAT Attestation Results
<a href="https://github.com/veraison/rust-ear">rust-ear</a>: Rust implementation of EAT Attestation Results
<a href="https://github.com/veraison/ear">c-ear</a>: C implementation of EAT Attestation Results</p>
<p><a href="https://github.com/veraison/cmw">cmw</a>: implementation for  RATS WG Conceptual Message Wrappers (draft-ftbs-rats-msg-wrap) for attestation related data encapsulation.</p>
<h4 id="verifier-provisioning"><a class="header" href="#verifier-provisioning">Verifier Provisioning</a></h4>
<p>These libraries provide support for the standard information models used to convey data to a Verifier.</p>
<p><a href="https://github.com/veraison/corim">corim</a>: manipulation of Concise Reference Integrity Manifest (CoRIM) and Concise Module Identifier (CoMID) tags. Also includes cocli CLI tool, that assists users creating CoRIM &amp; CoMID tags.</p>
<p><a href="https://github.com/veraison/swid">swid</a> : SWID and CoSWID manipulation library</p>
<h4 id="cose"><a class="header" href="#cose">COSE</a></h4>
<p><a href="https://github.com/veraison/go-cose">go-cose</a>: go library for CBOR Object Signing and Encryption (COSE)</p>
<h2 id="architecture-specific-libs"><a class="header" href="#architecture-specific-libs">Architecture specific libs</a></h2>
<p>This collection of libraries provides manipulation and verification functionality for Attestation formats of various architectures.</p>
<p><a href="https://github.com/veraison/psatoken">psatoken</a>: Platform Security Abstraction (PSA) Attestation Token manipulation library.</p>
<p><a href="https://github.com/veraison/ccatoken">ccatoken</a>
A library for the Arm Confidential Computing Architecture (CCA) Attestation Token.</p>
<p><a href="https://github.com/veraison/dice">dice</a>: library providing support functions for manipulating various profiles of DICE.</p>
<p><a href="https://github.com/veraison/parsec">parsec</a>: Library support for handling the Parsec Key Attestation formats used in the attested TLS PoC.</p>
<p><a href="https://github.com/veraison/enact-demo">enact-demo</a>: EnactTrust TPM/Veraison interop demo and related docs</p>
<hr />
<p><strong>See also</strong>: <a href="https://github.com/veraison/docs/blob/main/repo-guide.md">repo
guide</a> inside
<a href="https://github.com/veraison/docs">docs</a> repo.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="remote-attestation-verification-services"><a class="header" href="#remote-attestation-verification-services">Remote Attestation Verification Services</a></h1>
<p>Veraison provides a reference implementation of remote verification of
attestation services. This implementation provides REST API for</p>
<ul>
<li>provisioning of trust anchors and endorsements/reference values</li>
<li>verification of evidence based on pre-defined attestation scheme, and
(optionally) deployment-specific policies</li>
<li>management of deployment-specific policies</li>
</ul>
<p>The implementation broadly adheres to RATS architectures defined by <a href="https://www.ietf.org/rfc/rfc9334.html">RFC
9334</a>. The core functionality is
agnostic of attestation scheme details. Scheme-specific logic is provided via
plugins. <a href="https://www.openpolicyagent.org/">OPA</a>-based policies can optionally
be used to augment the plugin-defined process.</p>
<p>This implementation can be found on
<a href="https://github.com/veraison/services">GitHub</a>.</p>
<p>For installation instructions please see <a href="services/deployments/overview.html">Deployments</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="architecture"><a class="header" href="#architecture">Architecture</a></h1>
<p>Veraison services consist of the following</p>
<ul>
<li>a provisioning service that provides provisioning REST API</li>
<li>a verification service that provides challenge/response REST API</li>
<li>a VTS (Veraison Trusted Services) service that serves a trusted backend for
the above</li>
<li>a management service that provides policy management API</li>
<li>a number of attestation scheme plugins</li>
</ul>
<p>Optionally, a Keycloak server can be used for authentication, and a PostgreSQL
or MySQL/MariaDB DBMS can be used for endorsements, trust anchors, and policies
stores.</p>
<img src="services/../images/veraison-architecture.drawio.png" class="center" style="padding: 20px">
<p>Veraison broadly adheres to <a href="https://www.ietf.org/rfc/rfc9334.html">RATS
architecture</a>, with the following
exceptions:</p>
<ul>
<li>RATS separates provisioned artefacts into Endorsements and Reference Values.
Veraison separates them into Endorsements and Trust Anchors. An "endorsement"
in Veraison broadly includes what RATS terms "reference values", as well as
"endorsements". A trust anchor in Veraison is something that can be used to
verify the integrity of provisioned evidence (e.g. a CA certificate, or a
public key).</li>
<li>What RATS calls "policy" is divided in Veraison into policies and attestation
schemes. A scheme in Veraison is implemented via a plugin and contains the
common part of the RATS "policy" that is likely to be stable able across
deployments (how evidence and provisioned values should be appraised).
Veraison also allows specifying additional policies written in rego language
that can provide deployment-specific overrides the results produced by a
scheme.</li>
</ul>
<p>Attestation results are generated in <a href="services/attestation_result.html">EAR</a> format.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="device-and-supply-chain-modelling"><a class="header" href="#device-and-supply-chain-modelling">Device and Supply Chain modelling</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>This document sets out the accumulated knowledge and / or assumptions about:</p>
<ul>
<li>the evidence available within a device which can be used for attestation</li>
<li>models for firmware release lifecycles</li>
<li>observations on how multiple products may be released from a single source and the implications for provisioning data</li>
</ul>
<p>Why are these significant? The models here have driven the design of the Veraison system, in particular the way supply chain data is provisioned into the system and the Endorsement store is constructed to allow verification queries to access reference values to be used for evidence appraisal. Those design conclusions can be found in other documents.</p>
<p>The Veraison project welcomes feedback from real world examples as to the accuracy of the models and assumptions used here. The project will be seeking confirmation on these models from industry partners. If you have views on these topics, please provide relevant commentary via a github issue or start a conversation on the Zulip channel.</p>
<h2 id="device-evidence-classification"><a class="header" href="#device-evidence-classification">Device evidence classification</a></h2>
<p>The evidence within an attestation report can be categorised into the following classes. These classes are not an exhaustive set of all types of evidence that may be found within a report but are those necessary for correlating evidence with endorsement / reference value queries.</p>
<h3 id="trust-anchor"><a class="header" href="#trust-anchor">Trust Anchor</a></h3>
<p>All devices are ASSUMED to contain a Trust Anchor (TA) or a descendant from a Trust Anchor. This is normally provisioned into the device at manufacturing time but may also be provisioned to the device on enrolling into a management structure. The TA takes the form of a key or a seed from which an Attestation signing key can be derived. The attestation report will contain information, referred to here as a Trust Anchor ID (TA-ID). A Verifier can use the TA-ID to locate an endorsement providing information on the public value of the relevant key to use to validate the signature on a report. The Trust Anchor may have unique-to-device or group scope (i.e. multiple devices contain the same trust anchor). The latter case has been used as one solution for privacy protection use cases.</p>
<h3 id="hardware-group"><a class="header" href="#hardware-group">Hardware Group</a></h3>
<p>A device MAY contain a Hardware Group ID that is presented in attestation evidence. This is an identifier, provisioned during manufacturing, which can be used to classify the SoC used within the device and will be the same for any devices built using that SoC. Although termed as a hardware ID, in fact this identifier will classify the immutable Root of Trust, being the un-modifiable and un-measured first boot component as well as the specific SoC hardware within the SoC. The identifier is a public value and has no security value, but aids classification for a verifier. If no Hardware Group ID is included within the attestation evidence then an equivalent group identifier can be provisioned into the verifier as a correlation to the Trust Anchor ID.</p>
<h3 id="firmware"><a class="header" href="#firmware">Firmware</a></h3>
<p>A device is ASSUMED to produce evidence allowing the set of loaded firmware components to be identified. In some cases the device may summarise all loaded components into a single version number. In other cases a full set of measurements and metadata may be be made available to identify the set of firmware components loaded.</p>
<h3 id="workload"><a class="header" href="#workload">Workload</a></h3>
<p>An attestation report may include a series of measurements for the purpose of describing the workload running on a device. While a Veraison based attestation service can be capable of verifying such a series, there may not be a standard model for the reference values needed for this work. The workload is normally also divorced from the TCB and may require verification data to be obtained from a different supply chain from that used for device verification. This classification is therefore excluded from the device modelling assumptions.</p>
<h3 id="other-evidence"><a class="header" href="#other-evidence">Other Evidence</a></h3>
<p>Other evidence may be contained within the Attestation Report that does not fall into the above categories. This evidence may need to be referenced as part of an evidence appraisal policy, but no additional classification for a group of evidence is known at the moment to affect the modelling of Endorsements for the project.</p>
<p>Note: attestation reports may contain additional complexities to modelling evidence, such as having multiple attesters within a device or receiving an encrypted report. However, it is expected that these can be handled as precursors to report verification by deconstruction into core parts in a pre-verification pass.</p>
<p>Diagram: relevant groupings for evidence</p>
<p><img src="http://www.plantuml.com/plantuml/proxy?src=https://raw.githubusercontent.com/veraison/docs/main/diagrams/tokens-model.puml" alt="Groupings" /></p>
<p>Diagram: Known Tokens</p>
<p><img src="http://www.plantuml.com/plantuml/proxy?src=https://raw.githubusercontent.com/veraison/docs/main/diagrams/known-tokens.puml" alt="Diagram: Mapping known attestation tokens to the evidence classifications" /></p>
<h2 id="firmware-lifecycles"><a class="header" href="#firmware-lifecycles">Firmware Lifecycles</a></h2>
<p>Where an attestation report contains only a firmware version, the reference or "known good" value(s) specifying what the policy should compare the version with in order to make a determination of validity may need to be provisioned from the supply chain. Alternatively the handling of this value may be handled by alterations to the evidence appraisal policy.</p>
<p>If the attestation report contains a set of measurements describing the loaded firmware components, the situation is more complex but can offer the opportunity for a policy to make more nuanced appraisal choices. This case requires that the supply chain provisions information to the verifier about released firmware items for use by the appraisal policy.</p>
<p>At the same time, correlations can be established between firmware components and other evidence categories. This can be used to identify policy appraisals such as 'this hardware requires a certain set of firmware components to be trustworthy'.</p>
<p>Correlations can also be established between different released versions of firmware releases as a component is upgraded or patched. This allows a policy to gain appraisal policies such as whether a device is running up to date firmware or whether a firmware component is marked as having some vulnerability. Note that a distinction is made between an Update as being more likely to involve multiple fixes or components released at one time while a patch is more likely to be only a single component change to address a specific issue.</p>
<p>The project has considered multiple models for likely firmware component lifecycles over revised releases. These can be classified into the following categories:</p>
<ul>
<li>Model 1:
<ul>
<li>Updates: Release all components for whether changed or not (unchanged components have the same file released as on previous occasion)</li>
<li>Patches: Release only the patched (changed) component</li>
</ul>
</li>
<li>Model 2:
<ul>
<li>Updates: As model 1</li>
<li>Patches: Release all components, only patch components will be changed unpatched components have the same file released as on previous occasion</li>
</ul>
</li>
<li>Model 3:
<ul>
<li>Updates &amp; Patches: Always release all components; always rebuild all components whether changed or not.</li>
<li>Note that if a vendor is following practices such as from <a href="https://reproducible-builds.org/">Reproducible Builds</a> then Models 2 &amp; 3 are equivalent.</li>
</ul>
</li>
</ul>
<p>Metadata can be added at any time to any released component via the provisioning system.</p>
<p>Diagram: Firmware lifecycle models</p>
<p><img src="http://www.plantuml.com/plantuml/proxy?src=https://raw.githubusercontent.com/veraison/docs/main/diagrams/firmware-lifecycles.puml" alt="Diagram: Firmware lifecycle models" /></p>
<h2 id="beware-clashes-from-multiple-products"><a class="header" href="#beware-clashes-from-multiple-products">Beware clashes from multiple products</a></h2>
<p>The above classifications can be used to build a data model which will allow the relevant <strong>and related</strong> reference values / endorsements to be available for evidence appraisal. However, if a manufacturer releases multiple products using the same components <em>and</em> tokens from these products are handled by the same verification service, the creation of the data model must take into account these distinct products to avoid false lifecycle graphs. This is necessary to avoid, say, the implication that a firmware component is not up to date because a new release is available, which applies only to a different product. The concept of a product identity can be either created from a combination of evidence fields or be a created entity that is correlated to the TA-ID.</p>
<p>Diagram: Multi Product Models</p>
<p><img src="http://www.plantuml.com/plantuml/proxy?src=https://raw.githubusercontent.com/veraison/docs/main/diagrams/mult-prods.puml" alt="Diagram: Multi product models" /></p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="queries"><a class="header" href="#queries">Queries</a></h1>
<h2 id="overview-1"><a class="header" href="#overview-1">Overview</a></h2>
<p>This document contains definitions of "standard" endorsement queries. Queries
are the interface by which endorsements are exposed to the rest of the system.
A query definition consists of the following parts.</p>
<ol>
<li>Name: the name is how a query is referenced. It must be unique in a deployment.</li>
<li>Parameters: the descriptions of the parameters the query expects, i.e. the
input against which the query is run.</li>
<li>Result: the description of the matches returned by the query. (note: this
documents the format of a single match -- the query result is a slice of
such matches).</li>
</ol>
<h2 id="standard-queries"><a class="header" href="#standard-queries">Standard Queries</a></h2>
<h3 id="hardware_id"><a class="header" href="#hardware_id">hardware_id</a></h3>
<h4 id="parameters"><a class="header" href="#parameters">Parameters</a></h4>
<p><strong>platform_id</strong>: a <code>string</code> representation of the platform identifier extracted from the
evidence.</p>
<h4 id="result"><a class="header" href="#result">Result</a></h4>
<p>A <code>string</code> containing the hardware identifier for the platform from which the
evidence was extracted.</p>
<h3 id="software_components"><a class="header" href="#software_components">software_components</a></h3>
<h4 id="parameters-1"><a class="header" href="#parameters-1">Parameters</a></h4>
<p><strong>platform_id</strong>: a <code>string</code> representation of the platform identifier extracted from the
evidence.</p>
<h4 id="result-1"><a class="header" href="#result-1">Result</a></h4>
<p>A slice of <code>SoftwareEndorsement</code> instances containing the measurements of endorsed
software component versions associated with a particular platform.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h2 id="attestation-token-use-cases--assumptions"><a class="header" href="#attestation-token-use-cases--assumptions">Attestation Token use cases &amp; assumptions</a></h2>
<p>The following captures what is assumed about the nature of the attestation tokens received for verification.</p>
<p>A token is presented as a single 'blob' (byte stream).</p>
<p>Tokens are presented individually. If a batch mode submission is required, it is the responsibility of an API tier to pass them for verification one by one.</p>
<p>Encoding in transit is the responsibility of the API tier, the verification pipeline works on a byte stream.</p>
<p>The verification pipeline will receive some context information which will indicate or help to deduce the nature of the token and hence which plugins will be needed in the verification pipeline. In a dedicated deployment this may be hardwired, in an environment supporting multiple token types, this is likely to come from the API tier.</p>
<p>A token may have an encrypted body. Assuming the correct decryption key is available, the body will be decrypted and then passed into the pipeline in the same manner as an unencrypted token.</p>
<p>A presented token blob may actually contain multiple tokens, each of which will be handled - e.g., deserialised and have signing checked - independently such that an aggregation of all evidence contained is extracted and presented for appraisal</p>
<p>Bundled token models include both concatenation (e.g., a chain of certs packaged serially) and nesting (e.g., the value of a claim within one token may be a serialised independent token)</p>
<p>The set of endorsements / reference values required to appraise the evidence in a token is assumed to have been provisioned to the verifier service prior to the token being presented. The only exception to this is if an endorsement is included inline within the token and independently verifiable.</p>
<p>The exception to the above might be where the endorsement / reference values are held in an external service which the verifier must consult. In this case, the prior assumption applies to that external service.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="verification-machinery"><a class="header" href="#verification-machinery">Verification Machinery <!-- omit in toc --></a></h1>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents <!-- omit in toc --></a></h2>
<ul>
<li><a href="submods/docs/musings/verification-machine.html#verification-from-ten-thousand-feet">Verification From Ten Thousand Feet</a></li>
<li><a href="submods/docs/musings/verification-machine.html#a-closer-look-to-the-appraisal-process">A Closer Look to the Appraisal Process</a>
<ul>
<li><a href="submods/docs/musings/verification-machine.html#crypto-verification">Crypto Verification</a></li>
<li><a href="submods/docs/musings/verification-machine.html#reference-values-match">Reference Values match</a></li>
<li><a href="submods/docs/musings/verification-machine.html#endorsed-values-decoration">Endorsed Values Decoration</a></li>
<li><a href="submods/docs/musings/verification-machine.html#attestation-result-assembly-and-signing">Attestation Result assembly and signing</a></li>
</ul>
</li>
</ul>
<h2 id="verification-from-ten-thousand-feet"><a class="header" href="#verification-from-ten-thousand-feet">Verification From Ten Thousand Feet</a></h2>
<p>The picture below is yet another way to slice the <a href="https://www.rfc-editor.org/rfc/rfc9334.html#figure-1">RATS architecture</a>, which makes the (important) distinction between <em>"identity endorsements"</em> (e.g., verification keys), and <em>"endorsed values"</em> (e.g., certification status of the gadget, color, etc.), which is not explicit in RFC9334.</p>
<p>This distinction becomes relevant when zooming in to the <a href="submods/docs/musings/verification-machine.html#a-closer-look-to-the-appraisal-process">appraisal process</a> where one kind or the other is used depending on the verification "stage."</p>
<pre class="mermaid">flowchart TD
    R[(reference&lt;/br&gt;values)]
    Ev[(endorsed&lt;/br&gt;values)]
    Ei[(identity&lt;/br&gt;endorsement)]
    P[(appraisal policy&lt;/br&gt;for evidence)]
    VO([verifier&lt;/br&gt;owner])
    RFP([reference&lt;/br&gt;value&lt;/br&gt;provider])
    E([endorser])
    RP([relying&lt;/br&gt;party])
    A([attester])
    e((Evidence))
    a((Attestation&lt;/br&gt;Result))
    V([verifier])

    subgraph &quot; &quot;
    Ev
    Ei
    end

    subgraph &quot; &quot;
    R
    end
    
    subgraph &quot; &quot;
    P
    end

    VO --&gt; P
    RFP --&gt; R
    E --&gt; Ev
    E --&gt; Ei
    P --&gt; V
    R --&gt; V
    RP --&gt; e
    A --&gt; e
    Ev --&gt; V
    Ei --&gt; V
    V --&gt; a
    e --&gt; V
    A -.-&gt; RP

</pre>
<h2 id="a-closer-look-to-the-appraisal-process"><a class="header" href="#a-closer-look-to-the-appraisal-process">A Closer Look to the Appraisal Process</a></h2>
<p>The picture below provides a closer look in to the appraisal process, describing what a typical verification flow could look like.  The flow is broken down into four separate stages:</p>
<p><a href="submods/docs/musings/verification-machine.html#crypto-verification">Crypto Verification</a>
<a href="submods/docs/musings/verification-machine.html#reference-values-match">Reference Values match</a>
<a href="submods/docs/musings/verification-machine.html#endorsed-values-decoration">Endorsed Values Decoration</a>
<a href="submods/docs/musings/verification-machine.html#attestation-result-assembly-and-signing">Attestation Result assembly and signing</a></p>
<blockquote>
<p><strong>Notes</strong>:</p>
<ul>
<li>The appraisal policy is an input to all the processing stages</li>
<li>All non-final processing stages can output a "failure" signal that short circuits the appraisal</li>
</ul>
</blockquote>
<pre class="mermaid">flowchart TD
    v1[crypto&lt;/br&gt;verification]
    v2[refval&lt;/br&gt;match]
    v3[endorsed values&lt;/br&gt;decoration]
    v4[AR assembly&lt;/br&gt;and signing]
    Ei[(identity&lt;/br&gt;endorsement)]
    e((Evidence))
    P[(appraisal policy&lt;/br&gt;for evidence)]
    skV&gt;verifier signing key]
    a((Attestation&lt;/br&gt;Result))
    R[(reference&lt;/br&gt;values)]
    Ev[(endorsed&lt;/br&gt;values)]

    subgraph &quot; &quot;
    Ev
    Ei
    end

    subgraph &quot; &quot;
    R
    end
    
    subgraph &quot; &quot;
    P
    end

    subgraph stages[&quot;verifier stages&quot;]
    v1
    v2
    v3
    v4
    end

    subgraph &quot; &quot;
    skV
    end

    e --&gt; v1
    Ei --&gt; v1
    v1 -- evidence claims-set --&gt; v2
    P --&gt; stages
    v2 -- evidence claims-set --&gt; v3
    v3 -- evidence claims-set&lt;/br&gt;derived claims-set --&gt; v4
    skV --&gt; v4
    v4 --&gt; a
    R --&gt; v2
    Ev --&gt; v3
    v1 -- failure --&gt;v4
    v2 -- failure --&gt;v4
</pre>
<h3 id="crypto-verification"><a class="header" href="#crypto-verification">Crypto Verification</a></h3>
<blockquote>
<p>Input:</p>
<ul>
<li>Evidence to be verified</li>
<li>Identity endorsements</li>
</ul>
</blockquote>
<ol>
<li>Look up the matching identity endorsement / trust anchor (e.g., a raw public key, an x509 cert, etc.)</li>
<li>Use the key material to verify the Evidence's cryptographic envelope</li>
</ol>
<blockquote>
<p>Output:</p>
<ul>
<li>the (cryptographically verified) Evidence's claims-set</li>
</ul>
</blockquote>
<pre class="mermaid">flowchart TD
    v1[crypto&lt;/br&gt;verification]
    Ei[(identity&lt;/br&gt;endorsement)]
    e((Evidence))
    P[(appraisal policy&lt;/br&gt;for evidence)]
    Ecs((evidence&lt;/br&gt;claims-set))
    FAIL(((&quot;failure&quot;)))

    v1 --&gt; FAIL
    Ei --&gt; v1
    e --&gt; v1
    v1 --&gt; Ecs
    P --&gt; v1
</pre>
<h3 id="reference-values-match"><a class="header" href="#reference-values-match">Reference Values match</a></h3>
<blockquote>
<p>Input:</p>
<ul>
<li>Evidence claims-set</li>
<li>Reference values</li>
</ul>
</blockquote>
<ol>
<li>Look up any applicable reference values</li>
<li>Match reference values against the claims-set</li>
</ol>
<blockquote>
<p>Output:</p>
<ul>
<li>(validated) Evidence claims-set</li>
</ul>
</blockquote>
<pre class="mermaid">flowchart TD
    v2[refval&lt;/br&gt;match]
    P[(appraisal policy&lt;/br&gt;for evidence)]
    R[(reference&lt;/br&gt;values)]
    Ecs1((evidence&lt;/br&gt;claims-set))
    Ecs2((evidence&lt;/br&gt;claims-set))
    FAIL(((&quot;failure&quot;)))

    v2 --&gt; FAIL
    v2 --&gt; Ecs2
    R --&gt; v2
    Ecs1 --&gt; v2
    P --&gt; v2
</pre>
<h3 id="endorsed-values-decoration"><a class="header" href="#endorsed-values-decoration">Endorsed Values Decoration</a></h3>
<blockquote>
<p>Input:</p>
<ul>
<li>The Evidence claims-set</li>
<li>Endorsed values</li>
</ul>
</blockquote>
<ol>
<li>Look up applicable endorsed values</li>
<li>decide (based on policy) which endorsed values can be added to the claims-set</li>
</ol>
<blockquote>
<p>Output:</p>
<ul>
<li>Evidence claims-set</li>
<li>Derived claims-set</li>
</ul>
</blockquote>
<pre class="mermaid">flowchart TD
    v3[endorsed values&lt;/br&gt;decoration]
    P[(appraisal policy&lt;/br&gt;for evidence)]
    Ev[(endorsed&lt;/br&gt;values)]
    Ecs1((evidence&lt;/br&gt;claims-set))
    Ecs2((evidence&lt;/br&gt;claims-set))
    Dcs((derived&lt;/br&gt;claims-set))
    FAIL(((&quot;failure&quot;)))

    Ev --&gt; v3
    Ecs1 --&gt; v3
    v3 --&gt; FAIL
    v3 --&gt; Dcs
    v3 --&gt; Ecs2
    P --&gt; v3
</pre>
<h3 id="attestation-result-assembly-and-signing"><a class="header" href="#attestation-result-assembly-and-signing">Attestation Result assembly and signing</a></h3>
<blockquote>
<p>Input:</p>
<ul>
<li>Evidence and Derived claims-set, or a failure signal</li>
<li>the Verifier private key that signs the attestation result</li>
</ul>
</blockquote>
<ol>
<li>Determine the attestation result claims-set based on the input claims-set and policy</li>
<li>Sign the final attestation result statement</li>
</ol>
<blockquote>
<p>Output:</p>
<ul>
<li>Signed attestation results</li>
</ul>
</blockquote>
<pre class="mermaid">flowchart TD
    v4[AR assembly&lt;/br&gt;and signing]
    P[(appraisal policy&lt;/br&gt;for evidence)]
    skV&gt;verifier signing key]
    a((Attestation&lt;/br&gt;Result))
    Ecs((evidence&lt;/br&gt;claims-set))
    Dcs((derived&lt;/br&gt;claims-set))
    FAIL(((&quot;failure&quot;)))

    FAIL --&gt; v4
    Ecs --&gt; v4
    Dcs --&gt; v4
    P --&gt; v4
    skV --&gt; v4
    v4 --&gt; a
</pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="veraison-in-a-tee"><a class="header" href="#veraison-in-a-tee">Veraison in a TEE</a></h1>
<h2 id="abstract-model"><a class="header" href="#abstract-model">Abstract Model</a></h2>
<p>A Veraison services workload (<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span>) runs in a TEE (<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>).</p>
<h3 id="keys"><a class="header" href="#keys"> Keys</a></h3>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> has its own attestation key pair <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">⟨</span><span class="mord mathcal" style="margin-right:0.075em;">S</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathcal" style="margin-right:0.08222em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">⟩</span></span></span></span>.</p>
<p>At start-up, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> generates its signing key-pair <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">⟨</span><span class="mord mathcal" style="margin-right:0.075em;">S</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathcal" style="margin-right:0.08222em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">⟩</span></span></span></span>.</p>
<ul>
<li><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> : <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathcal" style="margin-right:0.08222em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li>
<li><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> : <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span></li>
</ul>
<p>where <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0003em;vertical-align:-0.2503em;"></span><span class="mord mathnormal">ϵ</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathcal" style="margin-right:0.08222em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.075em;">S</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1433em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2503em;"><span></span></span></span></span></span></span></span></span></span></p>
<h3 id="appraisal"><a class="header" href="#appraisal">Appraisal</a></h3>
<p>We assume a pre-existing trust relationship between <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>, i.e.: <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span> trusts <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathcal" style="margin-right:0.08222em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> to be associated with <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>.</p>
<p>When appraisal is requested by a relying party <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span> (or an attester, if in passport mode), <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> replies with an attestation result <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0003em;vertical-align:-0.2503em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mopen">[</span><span class="minner">…</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.075em;">S</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1433em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2503em;"><span></span></span></span></span></span></span></span></span></span> that, along with the appraisal result for the submitted evidence (<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span>), contains the most recently obtained workload and key attestation:</p>
<ul>
<li><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> : <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span></li>
<li><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> : <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.15em;vertical-align:-0.4em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mord"><span class="mord"><span class="mopen">[</span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">ϵ</span><span class="mclose">]</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1786em;"><span style="top:-2.4003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.075em;">S</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1433em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4em;"><span></span></span></span></span></span></span></span></span></span></li>
</ul>
<p>The relying party (or an auditor in its stead) can verify that:</p>
<ul>
<li>The key used to sign the attestation result matches the attested key (<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathcal" style="margin-right:0.08222em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is either published at a known location, or inlined in the attestation result);</li>
<li>The security state of platform and workload is as expected, and that their measurements are fresh enough.</li>
</ul>
<p>This binding scheme guarantees that <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span>'s identities (both as a cryptographic signer, and as a piece of running code &amp; configuration) cannot be separated, which prevents a <em>forwarding</em> attack where a rogue verifier <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9202em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">~</span></span></span></span></span></span></span></span></span></span> can use platform evidence not correlated to the outer signing key -- obtained in some way from a genuine verifier <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> -- to trick <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span> into thinking that platform and workload security state is as expected.</p>
<p><strong>Note:</strong> if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>'s are paced with a frequency that is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">≫</span></span></span></span> than the number of expected appraisals from the same <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>, a hash of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span> can be used instead, which reduces bandwidth requirements.</p>
<h2 id="nitro-instantiation"><a class="header" href="#nitro-instantiation">Nitro Instantiation</a></h2>
<p>When run in a Nitro Enclave, the abstract protocol elements are instantiated using the following claims in the <code>AttestationDocument</code> payload:</p>
<ul>
<li><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9334em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span></span></span></span>: there is no such thing in Nitro, one has to trust AWS via the AWS Nitro Attestation PKI, which includes a root certificate for the commercial AWS partitions.</li>
<li><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9334em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span></span></span></span>:
<ol>
<li><code>pcrs["PCR0"]</code> (Enclave image file),</li>
<li><code>pcrs["PCR1"]</code> (Linux kernel and bootstrap), and</li>
<li><code>pcrs["PCR2"]</code> (Application)</li>
</ol>
</li>
<li><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathcal" style="margin-right:0.08222em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>: <code>public_key</code></li>
<li><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>: <code>timestamp</code></li>
<li><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathcal" style="margin-right:0.075em;">S</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>: <code>certificate</code></li>
</ul>
<p>The complete <code>AttestationDocument</code> is provided below:</p>
<pre><code class="language-cddl">AttestationDocument = {
    module_id: text,               ; issuing Nitro hypervisor module ID
    timestamp: uint .size 8,       ; UTC time when document was created, in
                                   ; milliseconds since UNIX epoch
    digest: digest,                ; the digest function used for calculating the
                                   ; register values
    pcrs: { + index =&gt; pcr },      ; map of all locked PCRs at the moment the
                                   ; attestation document was generated
    certificate: cert,             ; the infrastructure certificate used to sign this
                                   ; document, DER encoded
    cabundle: [* cert],            ; issuing CA bundle for infrastructure certificate
    ? public_key: user_data,       ; an optional DER-encoded key the attestation
                                   ; consumer can use to encrypt data with
    ? user_data: user_data,        ; additional signed user data, defined by protocol
    ? nonce: user_data,            ; an optional cryptographic nonce provided by the
                                   ; attestation consumer as a proof of authenticity
}

cert = bytes .size (1..1024)       ; DER encoded certificate
user_data = bytes .size (0..1024)
pcr = bytes .size (32/48/64)       ; PCR content
index = 0..31
digest = "SHA384"
</code></pre>
<h3 id="notes"><a class="header" href="#notes"> Notes</a></h3>
<ol>
<li>The signed <code>AttestationDocument</code> can be stored in the discovery API endpoint of the verification frontend in a <code>ear-verification-key-attestation</code> claim.</li>
<li>We could use <code>user_data</code> in case we want to stash Veraison-specific data in the <code>AttestationDocument</code>, for example as a bstr-wrapped CBOR/JSON map.</li>
<li>The <code>nonce</code> field is conveniently optional, which plays well with our timestamp-based freshness model.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="deployments"><a class="header" href="#deployments">Deployments</a></h1>
<p>A deployment contains the Veraison services executables along with
configuration and other artefacts that are needed for them to work together.
Essentially, it is an installation of Veraison services.</p>
<p>Currently, the following deployments are supported:</p>
<ul>
<li><code>aws</code>: installs Veraison on AWS (requires an AWS account)</li>
<li><code>debian</code>: creates a .deb package</li>
<li><code>docker</code>: builds and installs Veraison inside Docker containers</li>
<li><code>rpm</code>: creates a .rpm package</li>
<li><code>native</code>: builds and installs Veraison on the current system, using existing
Go toolchain</li>
</ul>
<h2 id="what-deployment-should-i-use"><a class="header" href="#what-deployment-should-i-use">What deployment should I use?</a></h2>
<p>The <code>native</code> deployment is the quickest to build and easiest to work with. If
you want to try out Veraison, this is usually the way to go.</p>
<p>The <code>docker</code> deployment has fewer prerequisites and runs inside a more
controlled environment, however it is much slower to build. If you have trouble
building or running Veraison natively, <code>docker</code> deployment is worth trying
instead.</p>
<p><code>debian</code> and <code>rpm</code> deployments create packages that may be installed on other
systems.</p>
<p><code>aws</code> deployment runs Veraison on AWS. This is a reference for a more
"realistic" deployment of AWS.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="aws-deployment"><a class="header" href="#aws-deployment">AWS Deployment</a></h1>
<p>This deployment runs Veraison services and a Keycloak instance on EC2 instances
behind load balancers. An RDS instance running Postgres is used for key-value
stores, and a memcached instance is used for session management.</p>
<h2 id="dependencies"><a class="header" href="#dependencies">Dependencies</a></h2>
<p>This deployment depends on the <code>debian</code> deployment (which, in turn, depends on
the <code>native</code> deployment). Please see <a href="services/deployments/debian.html#dependencies">its
README</a> for the dependencies list.</p>
<p>Additionally, the following dependencies are required specifically for AWS deployment:</p>
<ul>
<li><code>curl</code>: used to transfer the Debian package to the EC2 node.</li>
<li><code>openssl</code>: used to generate TLS certs (note: unlike with <code>native</code> deployment,
where pre-generated certs may optionally be used, cert generation is mandatory
for this deployment, as the certs must be specific to the created EC2 instance).</li>
<li><code>packer</code>: used to build AMI images using temporary EC2 instances.</li>
<li><code>psql</code>: Postgres client used to initialise the stores (may be packaged on its
own or as part of <code>postgres</code>, depending on the platform).</li>
<li>A number of Python packages used by the deployment script. Please see
<a href="https://github.com/veraison/services/blob/main/deployments/aws/misc/requirements.txt">requirements.txt</a> for details.</li>
</ul>
<p><code>curl</code> and <code>openssl</code> should be available from your OS's package manager. Python
dependencies are installable via <code>pip</code>/<code>PyPI</code>. For <code>packer</code>, please see <a href="https://developer.hashicorp.com/packer/tutorials/aws-get-started/get-started-install-cli">its
documentation</a>.</p>
<h3 id="bootstrap"><a class="header" href="#bootstrap">Bootstrap</a></h3>
<p>To simplify dependency installation, the deployment script implements bootstrap
for Arch, Ubuntu, and MacOSX (using <a href="https://brew.sh">homebrew</a>).</p>
<pre><code class="language-bash">git clone https://github.com/veraison/services.git
cd services/deployments/aws

make bootstrap
</code></pre>
<p>(this will only work on the above-mentioned platforms).</p>
<h3 id="aws-account"><a class="header" href="#aws-account">AWS account</a></h3>
<p>You need an existing AWS account. Please see <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/credentials.html">boto3
documentation</a>
for how to configure <code>aws</code> CLI to access this account.</p>
<p>The AWS credentials will also need to available to <code>packer</code> tool. Where
<code>packer</code> looks for them is described by <a href="https://developer.hashicorp.com/packer/integrations/hashicorp/amazon#environment-variables">packer
docs</a>.</p>
<p>The simplest way to configure credentials is probably via Single Sign On (SSO).</p>
<ol>
<li>Run
<pre><code class="language-bash">aws configure sso
</code></pre>
and follow the interactive wizard to specify configuration.</li>
<li>Make sure the configuration works by doing
<pre><code class="language-bash">aws sso login
</code></pre>
You will need to periodically re-do this step when your current login
expires (usually around once a day).</li>
<li>Create <code>AWS_PROFILE</code> environment variable pointing to profile created in
step (1).
<pre><code class="language-bash">export AWS_PROFILE=&lt;YOU PROFILE NAME&gt;
</code></pre>
</li>
</ol>
<p>The steps above are not the only way to establish AWS credentials. Please refer
to the documentation linked above for alternatives.</p>
<h3 id="domain-and-certificate"><a class="header" href="#domain-and-certificate">Domain and certificate</a></h3>
<p>Finally, you need a domain registered in Route53, with a corresponding
certificate created in ACM. If you already have a domain with a different
registrar, you will need to transfer it to Route53.</p>
<p>The certificate MUST cover subdomains as well. For example, if you have
registered <code>my-domain.com</code> in Route53, the certificate should have
<code>*.my-domain.com</code> in its Subject Alternative Names.</p>
<p>For creating a new domain, please see <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/domain-register.html">Register a new
domain</a>
or <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/domain-transfer-to-route-53.html">Transferring registration for a
domain</a>.
For information on setting up a certificate in ACM please see <a href="https://docs.aws.amazon.com/acm/latest/userguide/gs.html">AWS Certificate
Manager</a></p>
<h2 id="quickstart"><a class="header" href="#quickstart">Quickstart</a></h2>
<p>Before creating a deployment, you need to provide account-specific
configuration that specifies the IDs of the VPC and subnets that will be used
for the deployment as well as the CIDR that will be granted access to the
deployment. Please use <a href="https://github.com/veraison/services/blob/main/deployments/aws/misc/arm.cfg">misc/arm.cfg</a> for an example.</p>
<p>Once the account-specific config file is created, define <code>AWS_ACCOUNT_CFG</code>
environment variable to point to it and execute <code>make deploy</code> to create the
deployment.</p>
<pre><code class="language-bash">export AWS_ACCOUNT_CFG=misc/arm.cfg  # replace with path to your config
make deploy
</code></pre>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>This could take a while -- in the order of 45 minutes, depending on how
responsive AWS is.</p>
</div>
<p>Deployment can be accessed via CLI front end:</p>
<pre><code class="language-bash">source env/env.bash  # for bash, or alternatively, env/env.zsh for Zsh users
veraison status
</code></pre>
<p>This should display the DNS name and IP address of the instance and show
Veraison services as active and running.</p>
<p>To make sure the deployment works, you can run through
<a href="https://github.com/veraison/services/blob/main/end-to-end/README.md">end-to-end</a> flow.</p>
<p>For example</p>
<pre><code class="language-bash"># env/env.bash must be sourced
../../end-to-end/end-to-end-aws provision
# followed by
../../end-to-end/end-to-end-aws verify rp
</code></pre>
<p>Finally, to remove the deployment, you can run</p>
<pre><code class="language-bash">make really-clean
</code></pre>
<h2 id="deployment-overview"><a class="header" href="#deployment-overview">Deployment overview</a></h2>
<p><img src="https://github.com/veraison/services/raw/main/deployments/aws/misc/deployment-diagram.drawio.png" alt="deployment diagram" /></p>
<p>Veraison is deployed into a dedicated VPC created within the AWS region
specified by <code>VERAISON_AWS_REGION</code> inside <code>deployment.cfg</code> (the region must
contain at least two availability zones). The address space for the VPC is
determined by <code>VERAISON_VPC_CIDR</code>. It must be large enough to accommodate four
subnets of equal size, with a subnet being large enough to hold the expected
number of instances (at least <code>/16</code> CIDR is recommended).</p>
<p>The VPC spans two availability zones, each containing a public and a private
subnet. The public subnets host load balancers for Veraison services and
Keycloak. The first public subnet also hosts the sentinel EC2 instance which is
used to configure RDS database. The private subnets host auto-scaled service
instances, keycloak instance, and the RDS instance.</p>
<p>The deployment adds three subdomains to the domain registered in route 53 --
one each for the services load balancer, keycloak load balancer, and the
sentinel instance.</p>
<h2 id="deployment-bring-up-and-tear-down"><a class="header" href="#deployment-bring-up-and-tear-down">Deployment bring up and tear down</a></h2>
<p><code>make</code> calls shown above just invoke <code>deployment.sh</code> with an appropriate
command. <code>make bootstrap</code> calls <code>deployment.sh bootstrap</code>, <code>make deploy</code> calls
<code>deployment.sh bringup</code>, and <code>make really-clean</code> calls <code>deployment.sh teardown</code>.</p>
<p><code>deployment.sh</code> loads the environment from <code>deployment.cfg</code> and the additional
file specified by <code>AWS_ACCOUNT_CFG</code>, and executes the function associated with
the specified command, which, in turn, calls through to the <code>bin/veraison</code>
script.</p>
<p>The first time <code>veraison</code> script is invoked, <code>--deployment-name</code> should be
specified before the subcommand to indicate which deployment the script's
subcommand should apply to. The script will remember it for future invocations,
so there is no need to specify it again unless you want to switch the current
deployment. <code>deployment.sh</code> take the value for this flag from
<code>VERAISON_AWS_DEPLOYMENT</code> environment variable (specified inside
<code>deployment.cfg</code>).</p>
<h3 id="bring-up"><a class="header" href="#bring-up">Bring up</a></h3>
<p>The bring up function creates the deployment. The deployment is created in
stages, with each stage corresponding to a subcommand of the <code>veraison</code> script.
The bring up stages are:</p>
<pre><code class="language-bash">veraison configure --init [...]
veraison create-deb
veraison create-key-pair

veraison create-vpc-stack

veraison create-sentinel-image
veraison create-rds-stack
veraison update-security-groups
veraison setup-rds

veraison create-signing-key

veraison create-services-image
veraison create-keycloak-image

veraison create-services-stack
</code></pre>
<h4 id="configure"><a class="header" href="#configure">configure</a></h4>
<p><code>configure</code> command is used to configure the deployment. It has optional
arguments to specify individual configuration points for the deployment. (use
<code>veraison configure --help</code> to list them). Configuration will be cached locally
and used by subsequent commands.</p>
<p>The <code>--init</code> flag indicates that this is an initial configuration for the
deployment. Any arguments not specified by this command will be set to default
values (or an error will be raised if no defaults exist). Without <code>--init</code> flag,
only the specified parameters will configured (this can be used to update an
existing configuration).</p>
<h4 id="create-deb"><a class="header" href="#create-deb">create-deb</a></h4>
<p>This is used to create a Debian package for Veraison services using the <a href="services/deployments/../debian">debian
deployment</a>. This is used to create the services image later.</p>
<h4 id="create-key-pair"><a class="header" href="#create-key-pair">create-key-pair</a></h4>
<p>This creates an AWS key pair that will be used to configure access to EC2
instances.</p>
<h4 id="create-sentinel-image"><a class="header" href="#create-sentinel-image">create-sentinel-image</a></h4>
<p>Creates an AMI image for the sentinel instance. The instance will be
provisioned with its own version of <code>veraison</code> script which can be found
<a href="services/deployments/misc/sentinel-commands">here</a>. The sentinel will be used to mediate access to
the RDS instance, which will not be directly accessible outside the VPC.</p>
<h4 id="create-rds-stack"><a class="header" href="#create-rds-stack">create-rds-stack</a></h4>
<p>This creates the RDS and sentinel instances via a CloudFormation stack.</p>
<h4 id="update-security-groups"><a class="header" href="#update-security-groups">update-security-groups</a></h4>
<p>This updates the sentinel instance's security group with your current public IP
address, which will enable SSH access to the instance. If your current address
is covered by <code>VERAISON_AWS_ADMIN_CIDR</code>, then this can be skipped.</p>
<p>If your ISP periodically changes your IP address, you may need to re-run this
command in the future.</p>
<h4 id="setup-rds"><a class="header" href="#setup-rds">setup-rds</a></h4>
<p>This initializes the RDS instance for use by Veraison services.</p>
<h4 id="create-signing-key"><a class="header" href="#create-signing-key">create-signing-key</a></h4>
<p>Create a new signing key in JWK format and upload it to AWS Secrets Manager.</p>
<h4 id="create-services-image-and-create-keycloak-image"><a class="header" href="#create-services-image-and-create-keycloak-image">create-services-image and create-keycloak-image</a></h4>
<p>This creates AMI images that will be used by the various EC2 instances  in the
deployment. Both of these need configuration for connecting to the RDS
instance, which is why the must be created after <code>setup-rds</code>.</p>
<h4 id="create-services-stack"><a class="header" href="#create-services-stack">create-services-stack</a></h4>
<p>Finally, this creates the load balancers, auto-scaling groups, etc to complete
the deployment. This also creates CNAME records for subdomains under the Route
53 domain associated with the deployment.</p>
<h3 id="teardown"><a class="header" href="#teardown">Teardown</a></h3>
<p>Teardown, like bring up, invokes a number of <code>veraison</code> subcommands:</p>
<pre><code class="language-bash">veraison delete-stack services
veraison delete-stack rds
veraison delete-stack vpc

veraison delete-image keycloak
veraison delete-image services
veraison delete-image sentinel

veraison delete-signing-key

veraison delete-key-pair
veraison delete-deb
</code></pre>
<p>This is more-or-less a reverse of what was done during bring up and should be
self-explanatory.</p>
<h2 id="managing-the-deployment"><a class="header" href="#managing-the-deployment">Managing the deployment</a></h2>
<p>In addition to containing the commands used during deployment bring up and
teardown, <code>veraison</code> script also acts as a CLI front-end for the deployment.</p>
<pre><code class="language-bash">veraison status
</code></pre>
<p>This shows a brief overview of the current state of the deployment -- which
images have been created, which stacks have been deployed, and the currently
running instances.</p>
<pre><code class="language-bash">veraison cache
</code></pre>
<p>This dumps the local cache associated with the deployment. This includes the
settings configured earlier using <code>veraison configure</code>, as well as various
outputs from bring up stages. Notably this contains <code>keycloak_admin_password</code>,
which will allow you to log into the Keycloak web interface.</p>
<pre><code class="language-bash">veraison stores
</code></pre>
<p>This shows the contents of the K-V stores used by the services. This includes
endorsements and trust anchors provisioned via the provisioning API, and
policies uploaded via the management API.</p>
<pre><code class="language-bash">veraison clear-store
</code></pre>
<p>This will empty the stores of all existing values. This can be useful during
testing.</p>
<pre><code class="language-bash">veraison shell
</code></pre>
<p>This opens an interactive shell on the sentinel instance. This can be used to
examine and debug the internal state of the deployment (aside from the API
endpoints, the sentinel is the only thing accessible outside the VPC).</p>
<pre><code class="language-bash">veraison dbshell
</code></pre>
<p>This opens an interactive Postgres shell on the RDS instance (via the
sentinel). The instance is used both for the Veraison services' K-Stores
(<code>veraison</code> database -- should be the default), and for Keycloak (<code>keycloak</code>
database).</p>
<pre><code class="language-bash">veraison follow [-s FROM] SERVICE_NAME
</code></pre>
<p>This outputs the last 10 minutes (by default) of logs from the specified
service and continues to print out new log entries in (near) real-time until
stopped with CTRL-C. How far back event history is printed can be changed via
-s/--start option which can take either an absolute date (in one of the common
formats) or relative time. E.g.</p>
<pre><code class="language-bash"># follow VTS service going back 2 hours
veraison follow -s 2h vts

# follow verification events since yesterday
veraison follow --start yesterday verification

# follow provisioning events since 20th July 2024 (note the US date ordering)
veraison follow --start 7/20/2024 provisioning
veraison follow --start 2024-07-20 provisioning

# follow VTS service going back 3 days
veraison follow --start "3 days ago" provisioning

</code></pre>
<p>The maximum unit of time for relative time is weeks (e.g. <code>2w</code> or <code>2 weeks</code>). If
you want a longer time period you have to convert it into days/weeks, or specify
and absolute starting date.</p>
<pre><code class="language-bash">veraison get-logs [-S SERVICE] [-s FROM] [-e TO] OUTPUT_DIRECTORY
</code></pre>
<p>This retrieves logs from CloudWatch and writes them to files in the specified
output directory. The files are called <code>{service}-stdout.log</code>. If the output
directory doesn't exist, it will be created (along with intermediate
directories, if necessary). It's possible to specify a service using <code>-S</code>
option, in which case only logs for the services will be obtained. The option
may be specified multiple times. It is possible to restrict the time period for
which the logs will be obtained using <code>-s/--start</code> and <code>-e/--end</code> options.
Parameters for these options should be in the same format as for <code>--start</code>
option for <code>follow</code> command (see above). There is also a shorter alias <code>logs</code> for
this command. E.g.</p>
<pre><code class="language-bash"># Obtain logs for all services writing them into files in "veraison-logs"
# subdirectory under current directory (creating it if necessary).
veraison get-logs ./veraison-logs


# Obtain VTS log for today writing it into ./veraison-logs/vts-stdout.log
veraison get-logs -S vts -s today veraison-logs

# Obtain logs for provisioning and verification services spanning time
# period from 10th December 2024 until yesterday
veraison logs -S provisioning -S verification -s 2024-12-10 \
     -e yesterday veraison-logs
</code></pre>
<p>As with <code>follow</code> command, the maximum time unit is weeks.</p>
<pre><code class="language-bash">veraison delete-logs
</code></pre>
<p>Completely delete logs from CloudWatch. This is mostly useful for debugging.
This command is also aliased as <code>clear-logs</code>.</p>
<pre><code class="language-bash">veraison restart-cwagent
</code></pre>
<p>Restarts CloudWatch agent running on service EC2 instances. This is necessary
if something happens to the log groups in CloudWatch -- the agent will not
upload events until restarted. (note: <code>delete-logs</code> command does this
automatically, so there is normally no need to use this command unless you,
e.g., manually delete the log groups in AWS web console).</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="debian-deployment"><a class="header" href="#debian-deployment">Debian deployment</a></h1>
<p>This creates a .deb package that may be installed on Linux distributions that
use <code>dpkg</code> as the package manager (e.g. Debian, Ubuntu, Mint). The package
installs Veraison into <code>/opt/veraison</code> and sets up systemd units for the
services.</p>
<h2 id="dependencies-1"><a class="header" href="#dependencies-1">Dependencies</a></h2>
<p>In addition to <a href="services/deployments/native.html#dependencies">dependencies for the native
deployment</a>, <code>dpkg</code> must be installed. If you
are on a Debian or Ubuntu system, <code>dpkg</code> will already be present as it the
package manager for your system. If you are on Arch, you can install it via</p>
<pre><code class="language-sh"># on Arch
pacman -S dpkg
</code></pre>
<p>If you are on another system, you will need to find how to install <code>dpkg</code> on
your own (first check that it is not the package manager for the system, then
search the system's standard packages; if all else fails -- duckduckgo/brave is
your friend).</p>
<h2 id="building-the-package"><a class="header" href="#building-the-package">Building the package</a></h2>
<p>The location where the package will be built is specified with <code>PACKAGE_DEST</code>
environment variable. It will default to <code>/tmp</code> if not set. To build the
package simply do</p>
<pre><code class="language-sh">git clone https://github.com/veraison/services.git
cd services/deployments/debian

make deb
</code></pre>
<p>This will create
<code>${PACKAGE_DEST}/veraison_deb_package/veraison_VERSION_ARCH.deb</code>, where <code>VERSION</code>
is the Veraison version as reported by the
<a href="https://github.com/veraison/services/blob/main/scripts/get-veraison-version"><code>get-veraison-version</code></a> script, and <code>ARCH</code> is
the architecture of your system as reported by <code>dpkg --print-architecture</code>.</p>
<p>Alongside the package, there will be a subdirectory with the same name but
without the .deb suffix that contains the "sources" used to build the package.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="docker-deployment"><a class="header" href="#docker-deployment">Docker Deployment</a></h1>
<p>This deploys Veraison a series of Docker containers on a dedicated Docker
network on the local machine.</p>
<h2 id="dependencies-2"><a class="header" href="#dependencies-2">Dependencies</a></h2>
<p>You will need to make sure you have <code>make</code>, <code>git</code>, <code>docker</code> (and its builder),
and <code>jq</code> installed on your system. Optionally, <code>tmux</code> can be used to
conveniently monitor output from running services. The CLI front-end relies on
<code>bash</code> shell, which should already be installed on most systems, but if not, it
would also need to be installed.</p>
<pre><code class="language-sh"># on Ubuntu
sudo apt install bash make git docker.io docker-buildx jq tmux

# on Arch
sudo pacman -S bash make git docker docker-buildx jq tmux

# On MacOSX with Homebrew
brew install step coreutils gettext openssl sqlite3 protobuf jq
brew link --force gettext
</code></pre>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p><strong>Ubuntu users</strong>: Make sure you have docker installed natively (via <code>sudo apt install docker.io</code>), and <em>not</em> via <code>snap</code>, as the later won't have access to
the default build contexts under <code>/tmp</code>. You could, of course, change those
locations via the config, however we cannot guarantee that there won't be
other issues -- if you decide to stick with <code>snap</code>, you're on your own.</p>
</div>
<h3 id="docker-set-up"><a class="header" href="#docker-set-up">Docker set up</a></h3>
<p>If you're not already set up to use Docker on your system, you will need to
make sure that it is enabled and running, and that you can access it by adding
your account to the <code>docker</code> group:</p>
<pre><code class="language-sh">sudo systemctl enable --now docker
sudo usrmod -a -G docker $USER
</code></pre>
<p>The user group modification won't take effect until you log out and log back
in, or, alternatively, you can force in a specific shell with</p>
<pre><code class="language-sh">newgrp docker
</code></pre>
<h2 id="creating-the-deployment"><a class="header" href="#creating-the-deployment">Creating the Deployment</a></h2>
<p>Once you have the pre-requisites, you can create the deployment on your local
system</p>
<pre><code class="language-sh">git clone https://github.com/veraison/services.git
cd services/deployments/docker

make
</code></pre>
<p>Once the deployment is created, you can set up the front end by executing</p>
<pre><code class="language-sh">source env.bash
</code></pre>
<p>inside a bash shell. There is an equivalent <code>env.zsh</code> for zsh (other shells are
currently not supported). You can interact with the deployment via the
<code>veraison</code> command. E.g.:</p>
<pre><code class="language-sh">veraison status
</code></pre>
<p>You should see output similar to</p>
<pre><code>         vts: stopped
provisioning: stopped
verification: stopped
  management: stopped
    keycloak: stopped
</code></pre>
<p>To start Veraison services run:</p>
<pre><code class="language-sh">veraison start
</code></pre>
<p>The provisioning service is now listening on port 9443, and verification
service on port 8443 (these can be changed via configuration -- see below).</p>
<p>Use the <code>-h</code> option to see the full list of available commands.</p>
<h2 id="deployment-composition"><a class="header" href="#deployment-composition">Deployment Composition</a></h2>
<p>The deployment exists on its own Docker network. Each of the services runs in
its own container. Service logs and VTS stores reside inside docker volumes,
independent of any container.</p>
<p><img src="https://github.com/veraison/services/raw/main/deployments/docker/misc/veraison-docker-deployment.png" alt="deployment composition" /></p>
<p>On the diagram above, the network is shown in orange, the volumes in purple,
the containers in blue, and the images the containers are based on in green.</p>
<p>In addition to the service container images, there also two images without
permanent containers. They are used to spawn ephemeral containers via <code>docker run --rm</code>.</p>
<p>The <code>builder</code> image contains the Go toolchain and other tools necessary to
build Veraison. It is used to compile the service binaries and their plugins
that are then used to construct the service containers. This image is also used
to spawn debug shells.</p>
<p>The <code>manager</code> image is used by the <code>veraison</code> frontend to, among other things,
access the volumes where the logs and provisioned values are stored.</p>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<p>The deployment may be configured by changing the settings inside
<a href="https://github.com/veraison/services/blob/main/deployments/docker/deployment.cfg">deployment.cfg</a>. See the comments inside that file for the
explanation of the individual configuration values.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The individual services rely on configuration inside <code>config.yaml.template</code>.
This currently uses the <code>sqlite3</code> driver for the store backend, which limits
request throughput and makes the deployment unsuitable for production or
performance testing (for the latter, one can modify the template to use
<code>memory</code> backend for the stores).</p>
</div>
<h3 id="make-options"><a class="header" href="#make-options"><code>make</code> Options</a></h3>
<p>You can set the following variables to influence the behaviour while executing
make targets:</p>
<p><code>DEBUG_HOST</code>: sets the host name for the debug container. This is useful if you
want to substitute the debug container in place of one of the service
containers.</p>
<p><code>DEBUG_PORT</code>: if set with a port number, that port on the debug container will
be forwarded to the host (debug container is run with <code>-p $(DEBUG_PORT):$(DEBUG_PORT)</code>).</p>
<p><code>DOCKER_BUILD_FLAGS</code>: additional flags to be passed to Docker when building
various images. This is passed to all image build invocations, so should only
be used for globally-applicable flags such as <code>--no-cache</code>.</p>
<h2 id="debugging"><a class="header" href="#debugging">Debugging</a></h2>
<p>Running <code>make debug</code> will pop up a "debug" shell inside the builder image. The
image has the build toolchain and the debugger installed, and
<code>/veraison/build/</code> directory is mapped onto the root of Veraison repo on your
host. This means you can make modifications to the source using your preferred
editor/IDE on the host, and then build and debug them in the debug shell.</p>
<h3 id="example-debugging-scheme-verification-plugin"><a class="header" href="#example-debugging-scheme-verification-plugin">Example: debugging scheme verification plugin</a></h3>
<p>For example, say you are implementing a new attestation scheme, and are running
into issues when attempting to verify your token (e.g. via an integration
tests test-case). There is not enough output in the logs to identify the issue,
and so, you'd like to set a breakpoint inside your code.</p>
<p>This needs to be done inside <code>vts-service</code>, as this is the component that
loads the evidence handler plugin used on the verification path.</p>
<p>First, assuming you have frontend set up, and the services running, (if not,
you can do so with <code>source env.bash; veraison start</code>), you will need to stop
the "production" VTS service with:</p>
<pre><code class="language-sh">veraison stop vts
</code></pre>
<p>this will stop <code>vts-service</code> but should leave the other services running (you
can verify that by running <code>veraison status</code>).</p>
<p>Next, enter the debug shell:</p>
<pre><code class="language-sh">make DEBUG_HOST=vts-service debug
</code></pre>
<p>this will pop open a <code>bash</code> shell inside the builder. The <code>DEBUG_HOST</code> argument
will set the hostname of the builder container. Here, we're setting it to the
hostname of the VTS service we just stopped, so that the provisioning and
verification services that are still running will now talk to our debug container
instead.</p>
<p>(Note: if you were replacing a REST service, rather than VTS, you would also
set the <code>DEBUG_PORT</code> variable to the value appropriate to the service (see
<a href="https://github.com/veraison/services/blob/main/deployments/docker/deployment.cfg">deployment.cfg</a>.)</p>
<p>Next, navigate to the location of the VTS service executable (keeping in mind
that the root of the repo is mapped to <code>/veraison/build</code> inside the container),
and start the debugger:</p>
<pre><code class="language-sh"># inside the debug shell:
cd /veraison/build/vts/cmd/vts-service
debug
</code></pre>
<p>The <code>debug</code> command is an alias for <code>dlv debug</code> that will make sure that the
debug executable will be built with evidence handling plugins compiled in (same
as if you ran <code>make SCHEME_LOADER=builtin</code>). This means you can set the
breakpoint inside your code directly from here, and you don't need to worry
about attaching the debugger to a separate plugin process.</p>
<p>(Note: the config.yaml files in service directories -- such as
<code>/veraison/build/vts/cmd/vts-service/config.yaml</code> -- that are loaded by
default, are configured for running the service directly on the build host,
outside docker. For running inside a docker container, the <code>config-docker.yaml</code>
in the same location should be used. <code>debug</code> command demonstrated above does
that, so you don't need to worry about it. However, if you want to run the
service executable directly, then you must remember to specify the appropriate
config, e.g.</p>
<pre><code class="language-sh"># inside the debug shell:
cd /veraison/build/vts/cmd/vts-service
./vts-service --config config-docker.yaml
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="native-deployment"><a class="header" href="#native-deployment">Native deployment</a></h1>
<p>The native deployment builds and installs Veraison services on the current
system using its native tools.</p>
<h2 id="dependencies-3"><a class="header" href="#dependencies-3">Dependencies</a></h2>
<p>To build Veraison services, you will need a Go toolchain, at least v1.22.
If Go is already installed, you can check the version:</p>
<pre><code class="language-sh">go version
</code></pre>
<p>If not, the instructions for downloading and installing Go on your platform can
be found <a href="https://go.dev/dl/">here</a>.</p>
<p>You will also need the protobuf compiler, <code>protoc</code>, with plugins for Go. The
plugins may be installed via <code>go install</code>:</p>
<pre><code class="language-bash">go install google.golang.org/protobuf/cmd/protoc-gen-go@v1.28
go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@v1.2
go install github.com/mitchellh/protoc-gen-go-json@latest
</code></pre>
<p>You will need GNU <code>make</code> (at least version 3.81) to drive the build process.</p>
<p>The deployment script is written for <code>bash</code> shell, and relies on <code>envsubst</code>
utility (which comes as part of <code>gettext</code> package on most systems), as well as
some common UNIX utilities that are often already present on a system but may
sometimes need to be installed: <code>find</code>, <code>grep</code>, <code>sed</code>.</p>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p><strong>MacOSX users:</strong> To enable <code>envsubst</code> and force it to link properly:</p>
<pre><code class="language-sh">brew install gettext
brew link --force gettext
</code></pre>
</div>
<p>For a full deployment, the following tools will also be needed:</p>
<ul>
<li><code>sqlite3</code> to initialize and manipulate the stores</li>
<li><code>jq</code> to display the stores' contents</li>
<li><code>openssl</code> (at least version 3.0) to generate the TLS certificates (not needed
if you plan to use the included example certs).</li>
<li><code>step</code> to generate the signing key (not needed if you plan to use the included
example key).</li>
<li><code>tmux</code> can optionally be used to run the deployment (not required).</li>
</ul>
<p>All except <code>step</code> should be available from package managers of most
distributions. For installing <code>step</code>, please see <a href="https://smallstep.com/docs/step-cli/installation/">its
documentation</a>.</p>
<h3 id="bootstrap-scripts"><a class="header" href="#bootstrap-scripts">Bootstrap scripts</a></h3>
<p>To simplify dependency installation, we have bootstrap scripts available for
Arch, Ubuntu, and MacOSX (using <a href="https://brew.sh">homebrew</a>) (see <code>bootstrap/</code>
subdirectory). Running</p>
<pre><code class="language-bash">git clone https://github.com/veraison/services.git
cd services/deployments/native

make bootstrap
</code></pre>
<p>will try to automatically select the appropriate script to run.</p>
<h3 id="checking-dependencies"><a class="header" href="#checking-dependencies">Checking dependencies</a></h3>
<p>You can check whether the required dependencies are present by running</p>
<pre><code class="language-bash">make check
</code></pre>
<p>This will report an error if a mandatory dependency is missing, or warnings if
one or more optional dependencies are missing.</p>
<h2 id="quick-deployment"><a class="header" href="#quick-deployment">Quick deployment</a></h2>
<p>To get Veraison running quickly you can run</p>
<pre><code class="language-bash">make quick-deploy
</code></pre>
<p>in this file's directory, or <code>make native-deploy</code> in the repo's top-level
directory.</p>
<p>This will create a deployment under <code>~/veraison-deployment</code> using the included
example key and certificates.</p>
<p>The deployment is controlled via a CLI frontend script,
<code>~/veraison-deployment/bin/veraison</code>. You can create an alias for it so that it
may be invoked simply as <code>veraison</code> by sourcing the deployments env file:</p>
<pre><code class="language-bash">source ~/veraison-deployment/env/env.bash
</code></pre>
<p>(the command above assumes you're using <code>bash</code> shell; there is also an
equivalent file for <code>zsh</code>).</p>
<h2 id="running-veraison"><a class="header" href="#running-veraison">Running Veraison</a></h2>
<p>You have three options for running the services:</p>
<pre><code class="language-bash"># option 1
veraison start-term

</code></pre>
<p>Will spawn a virtual terminal for each service.</p>
<pre><code class="language-bash"># option 2
export SESSION_NAME=veraison
veraison start-tmux $SESSION_NAME
</code></pre>
<p>will create a tmux session with the specified name (if no name is specified,
the default is "veraison"), and will start services inside panes within that
session.  You can then attach to the session with</p>
<pre><code class="language-bash">tmux attach -t $SESSION_NAME
</code></pre>
<p>Note that this requires that <code>tmux</code> is installed on the system.</p>
<p>Finally</p>
<pre><code class="language-bash"># option 3
veraison start-services
</code></pre>
<p>will install and start systemd/launchd services for the current user.</p>
<p>(Note: if you've deployed by running <code>make native-deploy</code> at top level, that will
automatically try to start services via systemd/launchd on systems that use them.)</p>
<h3 id="testing-the-deployment"><a class="header" href="#testing-the-deployment">Testing the deployment</a></h3>
<p>You can check that Veraison is running properly by running through the
<a href="https://github.com/veraison/services/blob/main/end-to-end/README.md">end-to-end flow</a>.</p>
<h2 id="step-by-step-deployment"><a class="header" href="#step-by-step-deployment">Step-by-step deployment</a></h2>
<p>There are multiple steps to creating a functioning Veraison deployment. <code>make quick-deploy</code> described above executes these steps in sequence with default
options for minimal hassle.</p>
<p>This section describes how to create a deployment by executing each step
individually using the <code>deployment.sh</code> script, and the options available for
each step.</p>
<h3 id="deployment-destination"><a class="header" href="#deployment-destination">Deployment destination</a></h3>
<p>The destination for the deployment is specified by <code>VERAISON_ROOT</code> environment
variable. If the variable does not exist, it defaults to
<code>~/veraison-deployment</code> (as seen above).</p>
<pre><code class="language-bash">export VERAISON_ROOT=~/alternate-deployment
</code></pre>
<p>If the specified location does not exist, it will be created by the script.</p>
<h3 id="step-1-build-veraison"><a class="header" href="#step-1-build-veraison">Step 1: build Veraison</a></h3>
<p>Veraison services can be built with</p>
<pre><code class="language-bash">./deployment.sh build
</code></pre>
<p>This is equivalent to running <code>make COMBINED_PLUGINS=1</code> at the top level. Note
that <code>COMBINED_PLUGINS</code> must be set, as the deployment will not use split
<code>-handler</code> plugins.</p>
<h3 id="step-2-create-and-populate-deployment-directory"><a class="header" href="#step-2-create-and-populate-deployment-directory">Step 2: create and populate deployment directory</a></h3>
<pre><code class="language-bash">./deployment.sh deploy
</code></pre>
<p>This create the deployment directory structure under <code>VERAISON_ROOT</code> (including
the <code>VERAISON_ROOT</code> itself if it doesn't already exist) and will copy the
service executables, (combined) plugins, the CLI frontend, and configuration
into the directory structure.</p>
<p>Alternatively, if you specify <code>-s</code> option:</p>
<pre><code class="language-bash">./deployment.sh -s deploy
</code></pre>
<p>then the service executables and plugins will be symbolically linked, rather
than copied. This is useful for development, so that you don't have keep
re-copying the executables after rebuilding them.</p>
<h3 id="step-3-set-up-tls-certificates"><a class="header" href="#step-3-set-up-tls-certificates">Step 3: set up TLS certificates</a></h3>
<p>Veraison services communicate with clients and with each other over TLS. Each
service will use its own certificate and associated key that it will pick up
from <code>${VERAISON_ROOT}/certs/</code> based on its name (e.g. VTS service will use
<code>${VERAISON_ROOT}/certs/vts.crt</code>.</p>
<p>These certificates can be generated for a deployment by providing a root
certificate that will be used to sign them. The root certificate maybe obtained
from a known Certificate Authority (such as <a href="https://letsencrypt.org/getting-started/">Let's
Encrypt</a>), or created locally (in
which case, it will be self-signed).</p>
<p>Certificate generation relies on <code>openssl</code> which must be installed on the
system.</p>
<h4 id="create-root-certificate"><a class="header" href="#create-root-certificate">Create root certificate</a></h4>
<p>A root certificate may be created by running</p>
<pre><code class="language-bash">./deployment.sh create-root-cert "/C=US/O=Acme Inc."
</code></pre>
<p>This will create <code>${VERAISON_ROOT}/certs/rootCA.crt</code> (and the associated
<code>${VERAISON_ROOT}/certs/rootCA.key</code>) with the specified subject. The subject
may be omitted from the invocation, in which case <code>/O=Veraison</code> will be used.</p>
<h4 id="create-service-certificates"><a class="header" href="#create-service-certificates">Create service certificates</a></h4>
<p>Once you have a root certificate (either generated in the sub-section above, or
obtained via some other means), you can use it to generate certificates for the
individual services.</p>
<p>In addition to the root certificate and key, you will also need to specify a
comma-separated list of names that will be used to populate the Common Name
field and Subject Alternative Name extension in the generated certificates.</p>
<pre><code class="language-bash">./deployment.sh init-certificates $(cat /etc/hostname),localhost \
    ${VERAISON_ROOT}/certs/rootCA.crt ${VERAISON_ROOT}/certs/rootCA.key
</code></pre>
<p>If you only plan to use the services locally, it is sufficient to only provide
"localhost" as the first argument.</p>
<p>The names in the list may contain the placeholder <code>@@</code> that will be replaced
with the name of the service.</p>
<p>For example, if you specify the first argument as</p>
<pre><code>@@.my-domain.com,@@-service.alt-domain.com,localhost
</code></pre>
<p>then the certificate generated for the VTS service  will contain the Subject</p>
<pre><code>/CN=vts.my-domain.com
</code></pre>
<p>and the SAN extension with</p>
<pre><code>DNS:vts.my-domain.com, DNS:vts-service.alt-domain.com, DNS:localhost
</code></pre>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>if you're using your own root certificate rather than generating one as in
sub-section above, you do not need to rename or copy it into
<code>${VERAISON_ROOT}/certs/</code> -- this will be done as part of <code>init-certificates</code>
command (the root cert key will not be copied as it won't be needed after
service certificates are generated).</p>
</div>
<h4 id="using-example-certificates"><a class="header" href="#using-example-certificates">Using example certificates</a></h4>
<p>It is also possible to just use included example certificates rather then
generating new ones for the deployment (these will, obviously, only work for
local use, as they won't be configured with your host's name).</p>
<pre><code class="language-bash">./deployment.sh -e init-certificates
</code></pre>
<p>When doing this, you do not need to create/provide a root certificate.</p>
<h3 id="step-4-set-up-signing-key"><a class="header" href="#step-4-set-up-signing-key">Step 4: set up signing key</a></h3>
<p>The signing key should be provided as <code>${VERAISON_ROOT}/signing/skey.jwk</code>. It
will be used by the verification service to sign attestation results. The key
must be in <a href="https://www.rfc-editor.org/rfc/rfc7517">JWK format</a>.</p>
<p>You can generate a new key for the deployment with</p>
<pre><code class="language-bash">./deployment.sh init-signing-key
</code></pre>
<p>Signing key generation relies on <code>step</code> which must be installed on the system
(see <a href="services/deployments/native.html#dependencies">dependencies</a> section above).</p>
<h4 id="using-example-signing-key"><a class="header" href="#using-example-signing-key">Using example signing key</a></h4>
<p>As with certificates, it is possible use the example key instead of generating
a new one:</p>
<pre><code class="language-bash">./deployment.sh -e init-signing-key
</code></pre>
<h3 id="step-5-initialize-stores"><a class="header" href="#step-5-initialize-stores">Step 5: initialize stores</a></h3>
<p>Veraison uses sqlite3 databases to store endorsements, trust anchors, and
policies. When started, services will expect these database to be initialized
with appropriate tables. This can be done by running</p>
<pre><code class="language-bash">./deployment.sh init-stores
</code></pre>
<h3 id="step-6-set-up-clients"><a class="header" href="#step-6-set-up-clients">Step 6: set up clients</a></h3>
<p>Veraison services can be interacted with via CLI applications, <code>cocli</code> for
provisioning, <code>evcli</code> for verification, and <code>pocli</code> for policy management.</p>
<p>These clients can be installed, along with appropriate configuration with</p>
<pre><code class="language-bash">./deployment.sh init-clients
</code></pre>
<h4 id="using-existing-clients-with-the-deployment"><a class="header" href="#using-existing-clients-with-the-deployment">Using existing clients with the deployment</a></h4>
<p>If you already <code>cocli</code> or other clients installed, you can use them, rather
than the ones bundled with the deployment. You can use <code>--config</code> option
to point to the deployment's config file for the client, e.g.</p>
<pre><code class="language-bash">cocli --config ${VERAISON_ROOT}/config/cocli/config.yaml OTHER_ARGS...
</code></pre>
<p>To avoid having to specify the config file each time, you can copy the
client-specific sub-directory into your <code>XDG_CONFIG_HOME</code> (usually
<code>~/.config/</code>)</p>
<pre><code class="language-bash">cp -r ${VERAISON_ROOT}/config/cocli ~/.config/
cocli OTHER_ARGS...
</code></pre>
<p>(The examples above use <code>cocli</code> but the same goes for <code>evcli</code> and <code>pocli</code> as
well.)</p>
<h2 id="deployment-directory-structure"><a class="header" href="#deployment-directory-structure">Deployment directory structure</a></h2>
<p>Once deployment has been created, <code>${VERAISON_ROOT}</code> has the following
structure</p>
<pre><code>.
├── bin
├── certs
├── config
├── env
├── logs
├── plugins
├── signing
├── stores
└── systemd (or launchd)
</code></pre>
<h4 id="bin"><a class="header" href="#bin"><code>bin</code></a></h4>
<p>This directory contains all executables associated with deployment, including
the CLI frontend, services, and clients.</p>
<p>(note: if the deployment was created with <code>-s</code> option, the service executables
will in fact be symlinks to their source locations.)</p>
<h4 id="config"><a class="header" href="#config"><code>config</code></a></h4>
<p>This directory has a number of sub-directories, one for the services, and one
for each client. Each subdirectory contains a <code>config.yaml</code> with associated
configuration.</p>
<h4 id="env"><a class="header" href="#env"><code>env</code></a></h4>
<p>This directly contains env files that may be sourced by various shells in order
to setup up the shell for use with the deployment (e.g. allowing the frontend
to be invoked without specifying its full path).</p>
<p>Currently, only <code>bash</code> and <code>zsh</code> are supported.</p>
<h4 id="logs"><a class="header" href="#logs"><code>logs</code></a></h4>
<p>This directory contains service logs.</p>
<h4 id="plugins"><a class="header" href="#plugins"><code>plugins</code></a></h4>
<p>This directly contains attestation scheme plugins.</p>
<p>(note: if the deployment was crated with <code>-s</code> option, the plugins will in fact
be symlinks to their source locations.)</p>
<h4 id="signing"><a class="header" href="#signing"><code>signing</code></a></h4>
<p>This directly contains <code>skey.jwk</code>, the key that will be used by the
verification service to sign attestation results.</p>
<h4 id="stores"><a class="header" href="#stores"><code>stores</code></a></h4>
<p>This directory contains sqlite3 database for the endorsements, trust anchors,
and policies stores.</p>
<h4 id="systemd-linux-only"><a class="header" href="#systemd-linux-only"><code>systemd</code> (Linux only)</a></h4>
<p>This directory contains systemd unit files for the Veraison services. It is
split into two sub-directories: <code>system</code> and <code>user</code>. The latter contains units
meant to be installed into the user-specific service manager (i.e. using
<code>systemctl --user</code>).</p>
<h4 id="launchd-macosx-only"><a class="header" href="#launchd-macosx-only"><code>launchd</code> (MacOSX only)</a></h4>
<p>This directory contains launchd user agent files for the Veraison services.</p>
<h2 id="setting-up-authentication-with-keycloak"><a class="header" href="#setting-up-authentication-with-keycloak">Setting up authentication with Keycloak</a></h2>
<p>Authentication is disabled by default in the native deployment. To enable it,
you first need to have the Keycloak authentication service running.</p>
<h3 id="installing-and-configuring-keycloak"><a class="header" href="#installing-and-configuring-keycloak">Installing and configuring Keycloak</a></h3>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Proper installation and setup of Keycloak is outside the scope of this
README. Please refer to the <a href="https://www.keycloak.org/getting-started/getting-started-zip">Keycloak
documentation</a>
for complete installation instructions. The instructions below show how to get
something running with minimal effort for local development and testing only.</p>
</div>
<p>Keycloak requires OpenJDK 21. This is not part of Veraison dependencies and is
not installed as part of bootstrap. If you don't already have it on your
system, you will need to install it.</p>
<pre><code class="language-bash"># On Arch
sudo pacman -S jdk21-openjdk

# On Ubuntu
sudo apt install openjdk-21-jdk
</code></pre>
<p>You will then need to make sure that <code>JAVA_HOME</code> points to it:</p>
<pre><code class="language-bash">export JAVA_HOME=/usr/lib/jvm/java-21-openjdk
</code></pre>
<p>Pick an install destination (must exist), and download and extract Keycloak
into it:</p>
<pre><code class="language-bash">export INSTALL_DEST=${HOME}
wget -O- https://github.com/keycloak/keycloak/releases/download/25.0.2/keycloak-25.0.2.tar.gz | \
    tar xzf - -C ${INSTALL_DEST}
export KEYCLOAK_ROOT=${INSTALL_DEST}/keycloak-25.0.2
</code></pre>
<p>Setup the new install to work with the deployment:</p>
<pre><code class="language-bash">./deployment.sh setup-keycloak ${KEYCLOAK_ROOT} localhost \
    ${VERAISON_ROOT}/certs/rootCA.{crt,key} 11111
</code></pre>
<p>The first argument to the <code>setup-keycloak</code> command is the root directory of the
keycloak installation. The second argument is a comma-separated list of names
that will be used in the certificate (in the listing above it's just
"localhost"). The third and fourth arguments are the root certificate and its
key that will be used to sign Keycloak's cert. This must be the same root cert
that was used for the Veraison deployment (the listing above assumes that
you've generated the root with <code>gen-root-cert</code> command as described above, if
not, then adjust the paths as appropriate). The final argument is the port
Keycloak will be listening on.</p>
<p>The setup command will also generate a new key for the server, and copy the
example Veraison realm into its data path.</p>
<p>Finally, re-build, and start the server:</p>
<pre><code class="language-bash">${KEYCLOAK_ROOT}/bin/kc.sh build
${KEYCLOAK_ROOT}/bin/kc.sh start --import-realm
</code></pre>
<p>The <code>--import-realm</code> option will cause the server to import the <a href="https://github.com/veraison/services/blob/main/deployments/native/example/keycloak/veraison-realm.json">example
veraison realm</a>.</p>
<h3 id="create-veraison-realm"><a class="header" href="#create-veraison-realm">Create Veraison realm</a></h3>
<p>If you imported the example realm when running the server, you do not need to
do this step.</p>
<ul>
<li>Veraison will expect the realm containing its configuration to be called
"veraison".</li>
<li>This realm must define "manager" and "provisioner" roles.</li>
<li>There must be at least one user associated with each role.</li>
<li>There must be at least one client setup with Authentication Flow
capabilities "Standard Flow" and "Direct Access Grants" enabled.</li>
</ul>
<p>Please refer to the <a href="https://www.keycloak.org/getting-started/getting-started-zip#_create_a_realm">Keycloak
docs</a>
for how to go about setting  up the above.</p>
<h3 id="enable-authentication-in-the-deployment"><a class="header" href="#enable-authentication-in-the-deployment">Enable authentication in the deployment</a></h3>
<p>Finally, enable authentication in the config files for services, cocli, and
pocli inside the deployment. This just means uncommenting the relevant config.
If you have set up a new veraison realm instead of using the example one, the
config values will also need to be updated.</p>
<h2 id="using-an-alternative-dbms"><a class="header" href="#using-an-alternative-dbms">Using an alternative DBMS</a></h2>
<p>By default, the deployment will use <code>sqlite3</code> databases located under
<code>${VERAISON_ROOT}/stores/</code> for key-value stores. It is possible to use either
MySQL/MariaDB or Postgres instead.</p>
<ol>
<li>Ensure the relevant DBMS is installed and running. Please refer to the DBMS'
and/or your OS' documentation for instructions on how to set that up.</li>
<li>Create a user and a database for the deployment, and initialize k-v store
tables for endorsements, trust anchors, and policies. Subdirectory
<a href="https://github.com/veraison/services/tree/main/deployments/native/kvstore-backends">kvstore-backends</a> contains scripts to automate this step.</li>
<li>Edit <code>*-store</code> entires inside <code>${VERAISON_ROOT}/config/services/config.yaml</code>
to comment out the <code>sqlite3</code> config, and uncommenting config for the
relevant driver (<code>pgx</code> for Postgres, and <code>mysql</code> for MySQL/MariaDB). You may
also need to edit the uncommented settings to match your set up in the
previous steps.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="rpm-deployment"><a class="header" href="#rpm-deployment">RPM Deployment</a></h1>
<p>This deployment creates a .rpm package that can be installed on Red Hat family
of distribution (e.g. Fedora, RHEL, Oracle Linux).The package installs Veraison
into <code>/opt/veraison</code> and sets up systemd units for the services.</p>
<h2 id="dependencies-4"><a class="header" href="#dependencies-4">Dependencies</a></h2>
<p>In addition to <a href="services/deployments/native.html#dependencies">dependencies for the native
deployment</a>, <code>rpm-build</code> must be installed. To
install all dependencies to build an rpm, run</p>
<pre><code class="language-sh">git clone https://github.com/veraison/services.git
cd services/deployments/rpm

make bootstrap
</code></pre>
<h2 id="building-the-package-1"><a class="header" href="#building-the-package-1">Building the package</a></h2>
<p>The location where the package will be built is specified with <code>PACKAGE_DEST</code>
environment variable. It will default to <code>/tmp</code> if not set. To build the
package simply do</p>
<pre><code class="language-sh">make rpm
</code></pre>
<p>This will create the following RPM package
<code>${PACKAGE_DEST}/veraison_VERSION_ARCH/rpmbuild/RPMS/ARCH/veraison-VERSION.FLA.ARCH.rpm</code>
where <code>VERSION</code> is the Veraison version as reported by the
<a href="https://github.com/veraison/services/blob/main/scripts/get-veraison-version"><code>get-veraison-version</code></a> script,
<code>ARCH</code> is the architecture of your system as reported by <code>arch</code>, and
<code>FLA</code> is the distro flavor such as el8 and el9.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="configuration-1"><a class="header" href="#configuration-1">Configuration</a></h1>
<p>Configuration for Veraison services is specified in YAML format. By default,
each executable will try to read configuration from a file called <code>config.yaml</code>
in that executable's current working directory (i.e. the directory it was
launched from -- not the directory the executable itself is located). An
alternative configuration file may be specified using <code>--config</code> option when
launching the executable.</p>
<h2 id="deployment-configuration"><a class="header" href="#deployment-configuration">Deployment configuration</a></h2>
<p>Services configured to run as part of a deployment (e.g. via systemd units)
will typically look for configuration in <code>config/services/config.yaml</code> under
the deployment's location. For example, services installed via <code>deb</code> or <code>rpm</code>
packages will have their configuration inside
<code>/opt/veraison/config/services/config.yaml</code>.</p>
<p>For <code>docker</code> and <code>aws</code> deployments, you normally shouldn't be modifying the
configuration inside the containers/EC2 instances directly. Please refer to the
deployments' documentation for information on how they may be configured.</p>
<h2 id="top-level-entries"><a class="header" href="#top-level-entries">Top-level entries</a></h2>
<p>The following top-level entries will be read for the config file:</p>
<ul>
<li><code>auth</code>: authentication configuration (used by management and provisioning
services)</li>
<li><code>ear-signer</code>: EAR signer configuration (used by vts service)</li>
<li><code>en-store</code>: endorsements key-value store configuration (used by vts service)</li>
<li><code>logging</code>: logging configuration (used by all services)</li>
<li><code>management</code>: management REST API service configuration (used by management
service)</li>
<li><code>plugin</code>: plugin loader configuration (used by vts and management services)</li>
<li><code>provisioning</code>: provisioning REST API service configuration (used by
provisioning service)</li>
<li><code>po-store</code>: policy key-value store configuration (used by vts and management
services)</li>
<li><code>sessionmanager</code>: verification service's session manager configuration (used
by verification service)</li>
<li><code>ta-store</code>: trust anchors key-value store configuration (used by vts service)</li>
<li><code>verification</code>: verification REST API service configuration (used by
verification service)</li>
<li><code>vts</code>: Veraison Trusted Services configuration (used by vts service)</li>
</ul>
<p>Each service executable will only look for the top-level entries it expects and
will ignore the rest.</p>
<h3 id="auth-configuration"><a class="header" href="#auth-configuration"><code>auth</code> configuration</a></h3>
<p>See <a href="services/configuration.html#authentication-configuration">Authentication configuration</a> below.</p>
<h3 id="ear-signer-configuration"><a class="header" href="#ear-signer-configuration"><code>ear-signer</code> configuration</a></h3>
<ul>
<li><code>alg</code>: the <a href="https://www.iana.org/assignments/jose/jose.xhtml#web-signature-encryption-algorithms">JWS algorithm</a>
used for signing, e.g.: <code>ES256</code>, <code>RS512</code>.</li>
<li><code>key</code>: URL with the location of the private key to be used with <code>alg</code>. The
following URL schems are supported:
<ul>
<li><code>file</code>: URL path is the path to a local file</li>
<li><code>aws</code>: URL path is in the form <code>&lt;region&gt;:&lt;secret-name&gt;</code> where <code>&lt;region&gt;</code>
is an AWS region, and <code>&lt;secrete-name&gt;</code> is the name under which the key is
stored in AWS Secrets Manager.
If a scheme is not specified, <code>file</code> is assumed.
The key is in <a href="https://datatracker.ietf.org/doc/rfc7517/">JWK format</a>.</li>
</ul>
</li>
</ul>
<h3 id="en-store-configuration"><a class="header" href="#en-store-configuration"><code>en-store</code> configuration</a></h3>
<p>See <a href="services/configuration.html#kv-store-configuration">KV Store configuration</a> below.</p>
<h3 id="logging-configuration"><a class="header" href="#logging-configuration"><code>logging</code> configuration</a></h3>
<ul>
<li><code>level</code> (optional): specify the minimum enabled logging level. Supported
values (from lowest to highest) are: <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code>.
Defaults to <code>info</code>.</li>
<li><code>format</code> (optional): specify the format of the log records (e.g. which
entries appear in it). Currently supported formats:<br />
<code>production</code>:  default <code>zap</code> production config.<br />
<code>development</code>: default <code>zap</code> development config.<br />
<code>bare</code>: a relatively bare format, featuring only log level (colored), logger
name, and its message, suffixed with any fields.</li>
<li><code>development</code> (optional): set to <code>true</code> to put the logger into development
mode. This changes the behavior of <code>DPanic</code> and takes stacktraces more
liberally.</li>
<li><code>disable-stacktrace</code> (optional): set to <code>true</code> to completely disable
automatic stacktrace capturing.</li>
<li><code>sampling</code> (optional): set the sampling policy. There are two possible
sub-settings: <code>initial</code> and <code>thereafter</code>, each is an integer value. <code>initial</code>
specifies how many messages, of a given level, will be logged as-is every
second. After than, only every <code>thereafter</code>'th message will be logged within
that seconds. e.g.
<pre><code class="language-yaml">  sampling:
    initial: 10
    thereafer: 5
</code></pre>
means, for very level (debug, info, etc) log the first 10 messages that occur
in 1 second. If more messages occur within the second, log every 5th message
after the first 10.</li>
<li><code>encoding</code> (optional): specifies logger encoding. Supported values:
<code>console</code>, <code>json</code>.</li>
<li><code>output-paths</code> (optional): a list of URLs or file paths to write logging
output to. By default, output is written to <code>stdout</code> (which may also be
specified as a "path" along other locations). In case the same configuration
is used by multiple services, you can insert <code>"{{ .service }}"</code> somewhere in
paths (part from  <code>stdout</code>/<code>stderr</code>) to have different services log into
different files.</li>
<li><code>err-output-paths</code> (optional): a list of URLs or file paths to write internal
logger errors to (note: <em>not</em> the error-level logging output). Defaults to
<code>stderr</code>. In case the same configuration is used by multiple services, you
can insert <code>"{{ .service }}"</code> somewhere in paths (part from
<code>stdout</code>/<code>stderr</code>) to have different services log into different files.</li>
<li><code>initial-fields</code> (optional): a map of key-value fields to add to
log records (in addition to those added by specific logging sites).</li>
</ul>
<h3 id="management-configuration"><a class="header" href="#management-configuration"><code>management</code> configuration</a></h3>
<ul>
<li><code>listen-addr</code> (optional): the address, in the form <code>&lt;host&gt;:&lt;port&gt;</code> the
management server will be listening on. If not specified, this defaults to
<code>localhost:8088</code>.</li>
<li><code>protocol</code> (optional): the protocol that will be used. Must be either "http" or "https". Defaults to "https" if not specified.</li>
<li><code>cert</code>: path to the x509 certificate to be used. Must be specified if protocol is "https"</li>
<li><code>cert-key</code>: path to the key associated with the certificate specified in <code>cert</code>. Must be specified if protocol is "https"</li>
</ul>
<h3 id="plugin-configuration"><a class="header" href="#plugin-configuration"><code>plugin</code> configuration</a></h3>
<p>The following directives are currently supported:</p>
<ul>
<li><code>backend</code>: specifies which plugin mechanism will be used. Currently the only
supported plugin backend is <code>go-plugin</code>.</li>
<li><code>&lt;backend name&gt;</code> (in practice, just <code>go-plugin</code>): configuration specific to
the backend.</li>
<li><code>builtin</code>: configuration used when plugins are disabled and scheme-specific
functionally is compiled into the VTS service executable. (Currently just a
place-holder as there is no configuration for the built-in loading mechanism.)
Note: enabling or disabling of plugins is a build-time option. It is not
possible to do so via configuration.</li>
</ul>
<h4 id="go-plugin-backend-configuration"><a class="header" href="#go-plugin-backend-configuration"><code>go-plugin</code> backend configuration</a></h4>
<ul>
<li><code>dir</code>: path to the directory that will be scanned for plugin executables.</li>
</ul>
<h3 id="po-store-configuration"><a class="header" href="#po-store-configuration"><code>po-store</code> configuration</a></h3>
<p>See <a href="services/configuration.html#kv-store-configuration">KV Store configuration</a> below.</p>
<h3 id="po-agent-configuration"><a class="header" href="#po-agent-configuration"><code>po-agent</code> configuration</a></h3>
<p>The following policy agent configuration directives are currently supported:</p>
<ul>
<li><code>backend</code>: specified which policy backend will be used. Currently supported
backends: <code>opa</code>.</li>
<li><code>&lt;backend name&gt;</code>: an entry with the name of a backend is used to specify
configuration for that backend. Multiple such entries may exist in a single
config, but only the one for the backend specified by the <code>backend</code> directive
will be used.</li>
</ul>
<h4 id="opa-backend-configuration"><a class="header" href="#opa-backend-configuration"><code>opa</code> backend configuration</a></h4>
<p>Currently, <code>opa</code> backend does not support any configuration.</p>
<h3 id="provisioning-configuration"><a class="header" href="#provisioning-configuration"><code>provisioning</code> configuration</a></h3>
<ul>
<li><code>listen-addr</code> (optional): the address, in the form <code>&lt;host&gt;:&lt;port&gt;</code> the provisioning
server will be listening on. If not specified, this defaults to
<code>localhost:8443</code>.</li>
<li><code>protocol</code> (optional): the protocol that will be used. Must be either "http" or "https". Defaults to "https" if not specified.</li>
<li><code>cert</code>: path to the x509 certificate to be used. Must be specified if protocol is "https"</li>
<li><code>cert-key</code>: path to the key associated with the certificate specified in <code>cert</code>. Must be specified if protocol is "https"</li>
</ul>
<h3 id="sessionmanager-configuration"><a class="header" href="#sessionmanager-configuration"><code>sessionmanager</code> configuration</a></h3>
<p>Session manager has a single configuration point: <code>backend</code>. This specifies
which <code>ISessionManager</code> implementation will be used. The following backends are
supported:</p>
<ul>
<li><code>ttlcache</code>: the default; this creates the session cache in memory of the
<code>verification-service</code> process.</li>
<li><code>memcached</code>: uses an external <a href="https://www.memcached.org/">memcached</a> server.</li>
</ul>
<p>All other entries under <code>sessionmanager</code> must be backend names (i.e. <code>ttlcache</code>
or <code>memcached</code>), providing backend-specific configuration. Only configuration
for the backend selected by <code>backend</code> entry will actually be used.</p>
<h4 id="ttlcache-backend"><a class="header" href="#ttlcache-backend"><code>ttlcache</code> backend</a></h4>
<p><code>ttlcache</code> backend does not have any configuration points.</p>
<h4 id="memcached-backend"><a class="header" href="#memcached-backend"><code>memcached</code> backend</a></h4>
<p><code>memcached</code> backend has the following configuration points:</p>
<ul>
<li><code>servers</code> (optional): a list of servers in "<host>:<port>" format that will
be used by the backend. The servers will be used with equal weight. Adding
the same entry multiple times increases its weight. If this is not specified,
it will default to <code>["localhost:11211"]</code>.</li>
</ul>
<h3 id="ta-store-configuration"><a class="header" href="#ta-store-configuration"><code>ta-store</code> configuration</a></h3>
<p>See <a href="services/configuration.html#kv-store-configuration">KV Store configuration</a> below.</p>
<h3 id="verification-configuration"><a class="header" href="#verification-configuration"><code>verification</code> configuration</a></h3>
<ul>
<li><code>listen-addr</code> (optional): the address, in the form <code>&lt;host&gt;:&lt;port&gt;</code> the verification
server will be listening on. If not specified, this defaults to
<code>localhost:8080</code>.</li>
<li><code>protocol</code> (optional): the protocol that will be used. Defaults to "https" if not specified. Must be either "http" or "https".</li>
<li><code>cert</code>: path to the x509 certificate to be used. Must be specified if protocol is "https"</li>
<li><code>cert-key</code>: path to the key associated with the certificate specified in <code>cert</code>. Must be specified if protocol is "https"</li>
</ul>
<h3 id="vts-configuration"><a class="header" href="#vts-configuration"><code>vts</code> configuration</a></h3>
<ul>
<li><code>server-addr</code> (optional): address of the VTS server in the form
<code>&lt;host&gt;:&lt;port&gt;</code>. If not specified, this defaults to <code>127.0.0.1:50051</code>. Unless
<code>listen-addr</code> is specified (see below), VTS server will extract the port to
listen on from this setting (but will listen on all local interfaces)</li>
<li><code>listen-addr</code> (optional): The address the VTS server will listen on in the
form <code>&lt;host&gt;:&lt;port&gt;</code>. Only specify this if you want to restrict the server to
listen on a particular interface; otherwise, the server will listen on all
interfaces on the port specified in <code>server-addr</code>.</li>
<li><code>tls</code> (optional): specifies whether TLS should be used for client
connections. Defaults to <code>true</code>.</li>
<li><code>cert</code>: path to the file containing the certificate that should be
used by the server if <code>tls</code> (see above) is <code>true</code>.</li>
<li><code>cert-key</code>: path to the file containing the key associated with the
certificate specified by <code>server-cert</code> (see above).</li>
<li><code>ca-certs</code> (optional): a list of paths to certificates that will be used
in addition to system certs during mutual validation with the client when
<code>tls</code> (see above) is <code>true</code>.</li>
</ul>
<h2 id="authentication-configuration"><a class="header" href="#authentication-configuration">Authentication configuration</a></h2>
<p>Authentication configuration is specified under <code>auth</code> top-level entry.</p>
<ul>
<li>
<p><code>backend</code>: specifies which auth backend will be used by the service. The
valid options are:</p>
<ul>
<li><code>passthrough</code>: a backend that does not perform any authentication, allowing
all requests.</li>
<li><code>none</code>: alias for <code>passthrough</code>.</li>
<li><code>basic</code>: Uses the Basic HTTP authentication scheme. See
<a href="https://datatracker.ietf.org/doc/html/rfc7617">RFC7617</a> for details. This
is not intended for production.</li>
<li><code>keycloak</code>: Uses OpenID Connect protocol as implemented by the Keycloak
authentication server.</li>
</ul>
</li>
</ul>
<p>The rest of the expected entries are defined by the value of <code>backend</code>. See
below for details of how to configure individual backends.</p>
<h3 id="passthrough"><a class="header" href="#passthrough">Passthrough</a></h3>
<p>No additional configuration is required. <code>passthrough</code> will allow all requests.
This is the default if <code>auth</code> configuration is not provided.</p>
<h3 id="basic"><a class="header" href="#basic">Basic</a></h3>
<ul>
<li>
<p><code>users</code>: this is a mapping of user names onto their bcrypt password hashes
and roles. The key of the mapping is the user name, the value is a further
mapping for the details with the following fields:</p>
<ul>
<li><code>password</code>: the bcrypt hash of the user's password.</li>
<li><code>roles</code>: either a single role or a list of roles associated with the
user. API authrization will be performed based on the user's roles.</li>
</ul>
</li>
</ul>
<p>On Linux, bcrypt hashes can be generated on the command line using <code>mkpasswd</code>
utility, e.g.:</p>
<pre><code class="language-bash">mkpasswd -m bcrypt --stdin &lt;&lt;&lt; Passw0rd!
</code></pre>
<p>For example:</p>
<pre><code class="language-yaml">auth:
  backend: basic
  users:
    user1:
      password: "$2b$05$XgVBveh6QPrRHXI.8S/J9uobBR7Wv9z4CL8yACHEmKIQmYSSyKAqC" # Passw0rd!
      roles: provisioner
    user2:
      password: "$2b$05$x5fvAV5WPkX0KXzqf5FMKODz0uyi2ioew1lOrF2Czp2aNH1LQmhki" # @s3cr3t
      roles: [manager, provisioner]
</code></pre>
<h3 id="keycloak"><a class="header" href="#keycloak">Keycloak</a></h3>
<ul>
<li><code>host</code> (optional): host name of the Keycloak service. Defaults to
<code>localhost</code>.</li>
<li><code>port</code> (optional): the port on which the Keycloak service is listening.
Defaults to <code>11111</code>.</li>
<li><code>realm</code> (optional): the Keycloak realm used by Veraison. A realm contains the
configuration for clients, users, roles, etc. It is roughly analogous to a
"tenant id". Defaults to <code>veraison</code>.</li>
<li><code>ca-cert</code>: the path to a PEM-encoded x509 cert that will be added to CA certs
when establishing connection to the Keycloak server. This should be specified
if the server has HTTPS enabled and the root CA for its cert is not installed
in the system.</li>
</ul>
<p>For example:</p>
<pre><code class="language-yaml">auth:
  backend: keycloak
  host: keycloak.example.com
  port: 11111
  realm: veraison
</code></pre>
<h2 id="kv-store-configuration"><a class="header" href="#kv-store-configuration">KV Store configuration</a></h2>
<p><code>kvstore</code> expects the following entries in configuration:</p>
<ul>
<li><code>backend</code>: the name of the backend to use for the store. Currently supported
backends: <code>memory</code>, <code>sql</code>.</li>
<li><code>&lt;backend name&gt;</code>: an entry with the name of a backend is used to specify the
configuration for that backend. There may be multiple such entries for different
backends. Only the entry matching the active backend specified by <code>backend</code>
directive will actually be used. The contents for each entry is specific to
the backend.</li>
</ul>
<p>Note: in a config file, <code>kvstore</code> configuration will typically be namespaced
under the name of a particular store instance, e.g.</p>
<pre><code class="language-yaml">ta-store:
  backend: sql
  sql:
    driver: sqlite3
</code></pre>
<h4 id="memory-backend-configuration"><a class="header" href="#memory-backend-configuration"><code>memory</code> backend configuration</a></h4>
<p>Currently, <code>memory</code> backend does not support any configuration.</p>
<h4 id="sql-backend-configuration"><a class="header" href="#sql-backend-configuration"><code>sql</code> backend configuration</a></h4>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p><code>sqlite3</code>, the default driver for the backend, is unsuitable for
production or performance testing.</p>
</div>
<ul>
<li><code>driver</code>: The name of the golang SQL driver. Veraison currently includes the
following drivers: <code>sqlite3</code>, <code>mysql</code> (MySQL and MariaDB), and <code>pgx</code>
(Postgres).</li>
<li><code>datasource</code>: This points to the database the driver will access. The format
is driver-dependent.
<ul>
<li><code>sqlite3</code>: the path to the sqlite3 database file</li>
<li><code>pgx</code>: a URL in the form <code>postgresql://&lt;user&gt;:&lt;passwd&gt;@&lt;host&gt;:&lt;port&gt;/&lt;database&gt;</code></li>
<li><code>mysql</code>: string in the form <code>&lt;user&gt;:&lt;password&gt;@&lt;protocol&gt;(&lt;address&gt;)/&lt;database&gt;</code>
(Please see the drivers' documentation for more details.)</li>
</ul>
</li>
<li><code>tablename</code> (optional): the name of the table within the SQL database that will
be used by the store. If this is not specified, it will default to <code>"kvstore"</code>.</li>
<li><code>max_connections</code> (optional): the maximum number of parallel connections to
DBMS that will be opened by the SQL driver. Once this number is reached,
further transactions will block until a connection becomes available.
Defaults to <code>10</code>.</li>
</ul>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p><code>max_connections</code>, like all settings above, is specific to the
store for which it is being configured. This means that the total maximum
numer of connectins Veraison will try to open is the sum of the
<code>max_connections</code> values for all three stores (<code>30</code> by default).</p>
</div>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>This is an example of a complete configuration for all Veraison services.</p>
<pre><code class="language-yaml">auth:
   backend: keycloak
   host: keycloak.example.com
   port: 11111
ear-signer:
  alg: ES256
  key: /opt/veraison/signing/skey.jwk
en-store:
  backend: sql
  sql:
    max_connections: 8
    driver: pgx
    datasource: postgres://veraison:p4ssw0rd@postgres.example.com:5432/veraison
    tablename: endorsements
logging:
  level: info
  output-paths:
    - stdout
    - /opt/veraison/logs/{{ .service }}-stdout.log
management:
  listen-addr: 0.0.0.0:8088
  protocol: https
  cert: /opt/veraison/certs/management.crt
  cert-key: /opt/veraison/certs/management.key
plugin:
  backend: go-plugin
  go-plugin:
    dir: /opt/veraison/plugins/
po-agent:
    backend: opa
po-store:
  backend: sql
  sql:
    max_connections: 8
    driver: pgx
    datasource: postgres://veraison:p4ssw0rd@postgres.example.com:5432/veraison
    tablename: policies
provisioning:
  listen-addr: 0.0.0.0:8888
  protocol: https
  cert: /opt/veraison/certs/provisioning.crt
  cert-key: /opt/veraison/certs/provisioning.key
sessionmanager:
  backend: memcached
  memcached:
    servers:
        - memcached1.example.com:11211
        - memcached2.example.com:11211
ta-store:
  backend: sql
  sql:
    max_connections: 8
    driver: pgx
    datasource: postgres://veraison:p4ssw0rd@postgres.example.com:5432/veraison
    tablename: trust_anchors
verification:
  listen-addr: 0.0.0.0:8080
  protocol: https
  cert: /opt/veraison/certs/verification.crt
  cert-key: /opt/veraison/certs/verification.key
vts:
  server-addr: localhost:50051
  tls: true
  cert: /opt/veraison/certs/vts.crt
  cert-key: /opt/veraison/certs/vts.key
  ca-certs: /opt/veraison/certs/rootCA.crt
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="attestation-schemes"><a class="header" href="#attestation-schemes">Attestation Schemes</a></h1>
<p>An attestation scheme describes how an attestation should be verified.
Specifically, it defines</p>
<ul>
<li>The structure of attestation evidence submitted for verification</li>
<li>The endorsements and trust anchors needed</li>
<li>How all of the above is evaluated to produce an <a href="https://datatracker.ietf.org/doc/draft-fv-rats-ear/">attestation
result</a></li>
</ul>
<p>Veraison supports different attestation schemes via plugins.</p>
<h2 id="current-schemes"><a class="header" href="#current-schemes">Current Schemes</a></h2>
<p>Currently the following schemes are implemented:</p>
<ul>
<li><code>arm-cca</code> Arm Confidential Compute Architecture attestation.</li>
<li><code>psa-iot</code>: Arm Platform Security Architecture attestation.</li>
<li><code>riot</code>: <a href="https://trustedcomputinggroup.org/work-groups/dice-architectures/">RIoT based DICE</a>-compatible
attestation (note: this does not implement any specific DICE architecture).</li>
<li><code>tmp-enacttrust</code>: TPM-based attestation for
<a href="https://www.enacttrust.com/">EnactTrust</a> security cloud.</li>
<li><code>parsec-tpm</code> : Parsec TPM based hardware-backed attestation, details
<a href="https://github.com/CCC-Attestation/attested-tls-poc/blob/main/doc/parsec-evidence-tpm.md">here</a></li>
<li><code>parsec-cca</code> : Parsec CCA based hardware-backed attestation, details
<a href="https://github.com/CCC-Attestation/attested-tls-poc/blob/main/doc/parsec-evidence-cca.md">here</a></li>
</ul>
<h2 id="implementing-attestation-scheme-support"><a class="header" href="#implementing-attestation-scheme-support">Implementing Attestation Scheme Support</a></h2>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>If you already have attestation scheme plugins implemented for an
earlier version of Veraison, please see the <a href="services/schemes/MIGRATING.html">migration guide</a>
for how to convert them to the new framework.</p>
</div>
<p>Supporting a new attestation scheme requires defining how to provision
endorsements (if any) by implementing <a href="services/schemes/../handler/iendorsementhandler.go"><code>IEndorsementHandler</code></a>,
how to process evidence tokens by implementing <a href="services/schemes/../handler/ievidencehandler.go"><code>IEvidenceHandler</code></a> and
how to create and obtain scheme-specific keys used to store and retrieve endorsements and trust anchors
by implementing <a href="services/schemes/../handler/istorehandler.go"><code>IStoreHandler</code></a>.</p>
<p>Finally, an executable should be created that <a href="services/schemes/../handler/plugin.go">registers</a>
and serves them.</p>
<pre><code class="language-go">package main

import (
	"github.com/veraison/services/decoder"
	"github.com/veraison/services/plugin"
)

type MyEvidenceHandler struct {}

// ...
// Implementation of IEvidenceHandler for MyEvidenceHandler
// ...

type MyEndrosementHandler struct {}

// ...
// Implementation of IEndrosementHandler for MyEndrosementHandler
// ...

type MyStoreHandler struct {}

// ...
// Implementation of IStoreHandler for MyStoreHandler
// ...

func main() {
	handler.RegisterEndorsementHandler(&amp;MyEndorsementHandler{})
	handler.RegisterEvidenceHandler(&amp;MyEvidenceHandler{})
	handler.RegisterStoreHandler(&amp;MyStoreHandler{})

	plugin.Serve()
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="arm-psa-and-cca-attestation"><a class="header" href="#arm-psa-and-cca-attestation">Arm PSA and CCA Attestation</a></h1>
<p>Evaluation of Arm <a href="https://www.arm.com/architecture/security-features/platform-security">Platform Security
Architecture</a>
and <a href="https://www.arm.com/architecture/security-features/arm-confidential-compute-architecture">Confidential Compute
Architecture</a> attestation evidence is implemented via <code>PSA_IOT</code> and <code>ARM_CCA</code> schemes, respectively.</p>
<h2 id="endorsements-and-trust-anchors"><a class="header" href="#endorsements-and-trust-anchors">Endorsements and Trust Anchors</a></h2>
<p>Endorsements and trust anchors for both schemes can be created and provisioned
using <a href="https://github.com/veraison/cocli"><code>cocli</code> command line tool</a>. The tool
has <a href="https://github.com/veraison/gen-corim/tree/master/data/templates">sample
templates</a>
for describing endorsements and trust anchors for both attestation schemes.</p>
<p>Endorsements can also be generated from evidence using <a href="https://github.com/veraison/gen-corim"><code>gen-corim</code> command
line tool</a>.</p>
<h2 id="attestation-evidence"><a class="header" href="#attestation-evidence">Attestation Evidence</a></h2>
<p>Attestation evidence can be submitted for verification using <a href="https://github.com/veraison/evcli"><code>evcli</code> command
line tool</a>.</p>
<p>Evidence formats for both schemes are defined as <a href="https://datatracker.ietf.org/doc/draft-ietf-rats-eat/">Entity Attestation
Token</a> (EAT) profiles.
See
<a href="https://datatracker.ietf.org/doc/draft-tschofenig-rats-psa-token/">draft-tschofenig-rats-psa-token</a>
and
<a href="https://datatracker.ietf.org/doc/draft-ffm-rats-cca-token/">draft-ffm-rats-cca-token</a>.</p>
<p>Library support exists for PSA tokens in <a href="https://github.com/veraison/psatoken">Go</a>.</p>
<p>Library support exists for CCA tokens in <a href="https://github.com/veraison/ccatoken">Go</a> and <a href="https://github.com/veraison/rust-ccatoken">Rust</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="dice"><a class="header" href="#dice">DICE</a></h1>
<h2 id="standard-documents"><a class="header" href="#standard-documents">Standard Documents</a></h2>
<p>Device Identifier Composition Engine (DICE) is an attestation standard developed by the Trusting Computing Group (TCG).  DICE builds on the device identity and device attestation concepts introduced in <a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/06/RIoT20Paper-1.1-1.pdf">Robust Internet-of-Things (RIoT)</a> from Microsoft Research.</p>
<p>The DICE specification is split across the following core documents:</p>
<ul>
<li><a href="https://trustedcomputinggroup.org/resource/hardware-requirements-for-a-device-identifier-composition-engine/">Hardware Requirements</a>, describing the DICE Root of Trust (RoT) and the construction of the (unique) Compound Device Identifier (CDI).</li>
<li><a href="https://trustedcomputinggroup.org/resource/dice-layering-architecture/">Layering Architecture</a>, describing the construction of a device's layered identity rooted in the CDI and obtained via the recursive invocation of a simple primitive based on measurements and per-device secret seeding.</li>
<li><a href="https://trustedcomputinggroup.org/resource/dice-attestation-architecture/">Attestation Architecture</a>, describing how DICE-based attestation fits in the wider <a href="https://www.ietf.org/archive/id/draft-ietf-rats-architecture-12.html">RATS architecture</a>.</li>
</ul>
<p>Other relevant documents include:</p>
<ul>
<li><a href="https://trustedcomputinggroup.org/resource/dice-certificate-profiles/">Certificate Profiles</a>, describing how X.509 certificates that carry public keys derived from DICE identities look like.</li>
<li><a href="https://trustedcomputinggroup.org/resource/symmetric-identity-based-device-attestation/">Symmetric Identity Based Device Attestation</a>, describing how to derive symmetric key material from DICE identities and how that could be used in authentication and attestation protocols.</li>
</ul>
<p>A further "DICE Endorsements Architecture" document, describing the information model (IM) for endorsed and reference values, is currently under revision in the TCG.  The official document is not yet published, but a data model based on the IM is available in the <a href="https://github.com/ietf-rats/ietf-corim-cddl">CoRIM repository</a> of which Veraison provides a <a href="https://github.com/veraison/corim">Golang implementation</a>.</p>
<h2 id="googles-open-profile-for-dice"><a class="header" href="#googles-open-profile-for-dice">Google's Open Profile for DICE</a></h2>
<p>Google has released the specification of an <a href="https://pigweed.googlesource.com/open-dice/+/HEAD/docs/specification.md">Open Profile for DICE</a> based on TCG's "Hardware Requirements" and "Layering Architecture" documents, along with a C99 implementation as part of the <a href="https://pigweed.dev">Pigweed</a> project.</p>
<p>While the core concepts are unchanged, there are a few notable differences from TCG DICE, mainly around the encoding of payloads.  See the <a href="services/schemes/dice.html#open-dice-formats">Open DICE Formats</a> section for the details.</p>
<h2 id="dice-concepts"><a class="header" href="#dice-concepts">DICE Concepts</a></h2>
<h3 id="glossary"><a class="header" href="#glossary">Glossary</a></h3>
<ul>
<li>
<p><strong>DICE Hardware RoT</strong> - The HW implementation of the DICE processing engine, acting as the terminal trust anchor in a DICE device.</p>
</li>
<li>
<p><strong>Unique Device Secret (UDS)</strong> - A permanent, (statistically) unique, secret value.  Every instance of a DICE device has its own UDS stashed away in a location only accessible to the DICE engine.  The UDS can be injected at manufacturing time, or generated by the device itself using a suitable PRNG.</p>
</li>
<li>
<p><strong>Trusted Computing Base (TCB)</strong> : All the security relevant HW and SW in a DICE device.  DICE organizes the TCB in multiple "components", which are grouped in "layers" stacked one on top of the other, starting with the DICE engine.  A layer boundary represents an explicit handover point from one component to one or more components in the "next" stage of the boot chain.</p>
</li>
<li>
<p><strong>TCB Component Identifier (TCI)</strong> - A (statistically) unique identifier for a TCB component.  This value is computed by digesting the component's measurement along with other component-specific attributes, e.g., vendor name, version, etc.</p>
</li>
<li>
<p><strong>TCB Info</strong> - The information model of a TCB component.  It gathers a standard set of attributes (and associate types) that describe a TCB, for example: its model, vendor, Firmware digests, version, etc.</p>
</li>
<li>
<p><strong>Compound Device Identifier (CDI)</strong> - This value represents the (statistically) unique identity of each layer in the bootstrap sequence.  The CDI for a given layer is obtained by hashing together the predecessor CDI and the TCI for the current layer.  This recursive construction is such that the resulting CDIs are inextricably chained: when one CDI changes (e.g., because the measured software component is updated, and the TCI mutates accordingly), all its successor CDIs change as well.  Crucially, the CDI is directly used as a seed for deriving cryptographic credentials (e.g., an ECDSA key pair) for the corresponding TCB component.</p>
</li>
</ul>
<blockquote>
<p>NOTE: At first it might seem like the scalability properties of DICE verification vis-a-vis software &amp; configuration updates of TCB components are terrible.  The verifier would have to be re-provisioned with all the updated identities of all the devices of the same "class" if a bit was flipped in their TCB.  Luckily, the situation is not so gloomy: as long as the lowest layer in the DICE chain is stable (as in "never updated") and the DICE compound identity is provided as a certification chain rooted either in the lowest layer or in an external CA that issues the cert for the lowest layer, an identity update of the i-th layer can be re-computed dynamically by a verifier without need to further interact with the supply chain -- except for re-provisioning the verifier with the updated measurement.  The key requirement is the stability of the so-called "Layer 0" / "First Mutable Code" (FMC), and therefore of its cryptographic identity.  The latter is a pretty important bit in DICE and it's given the proper name of "Device Id".  The Device Id key pair is associated with an IEEE 802.1AR IDevID cert.</p>
</blockquote>
<h3 id="evidence"><a class="header" href="#evidence">Evidence</a></h3>
<p>DICE models attestation evidence as a layered &amp; chained set of claims.  The claims in each layer are of two kinds:</p>
<ol>
<li>The cryptographic identity associated with the layer (typically, a public key),</li>
<li>The layer's measurements used as input in the identity derivation function.</li>
</ol>
<p>The recommended way to encode evidence is using standard X.509 scaffolding:</p>
<ol>
<li>A certificate for the layer's public key signed by the previous layer's private key,</li>
<li>A set of custom certificate extensions to encode the TCB measurements.</li>
</ol>
<p>Theoretically, other formats are acceptable; for example, Open-DICE envisages the use of chained CWTs).</p>
<h3 id="tcg-dice-formats"><a class="header" href="#tcg-dice-formats">TCG DICE Formats</a></h3>
<pre><code class="language-asn.1">tcg OBJECT IDENTIFIER ::= { 2 23 133 }

tcg-dice OBJECT IDENTIFIER ::= { tcg platformClass(5) 4 }
</code></pre>
<h4 id="tcb-info"><a class="header" href="#tcb-info">TCB Info</a></h4>
<p>TCB Info represents the data and metadata associated with the component identity.  It can be roughly split into two logically separate parts: naming / identification attributes on one side (i.e., <code>vendor</code>, <code>vendorInfo</code>, <code>model</code>, <code>version</code>, <code>svn</code>, <code>layer</code> and <code>index</code>), measurement values on the other (i.e., <code>fwids</code>, <code>flags</code> and <code>type</code>)</p>
<p>See Section 6.1.1 of the Attestation Architecture document for a detailed description of the semantics associated with individual fields.</p>
<pre><code class="language-asn.1">tcg-dice-TcbInfo OBJECT IDENTIFIER ::= {tcg-dice 1}

DiceTcbInfo ::== SEQUENCE {
    vendor      [0] IMPLICIT UTF8String OPTIONAL,
    model       [1] IMPLICIT UTF8String OPTIONAL,
    version     [2] IMPLICIT UTF8String OPTIONAL,
    svn         [3] IMPLICIT INTEGER OPTIONAL,
    layer       [4] IMPLICIT INTEGER OPTIONAL,
    index       [5] IMPLICIT INTEGER OPTIONAL,
    fwids       [6] IMPLICIT FWIDLIST OPTIONAL,
    flags       [7] IMPLICIT OperationalFlags OPTIONAL,
    vendorInfo  [8] IMPLICIT OCTET STRING OPTIONAL,
    type        [9] IMPLICIT OCTET STRING OPTIONAL
}

FWIDLIST ::== SEQUENCE SIZE (1..MAX) OF FWID

FWID ::== SEQUENCE {
    hashAlg OBJECT IDENTIFIER,
    digest OCTET STRING
}

OperationalFlags ::= BIT STRING {
    notConfigured (0),
    notSecure (1),
    recovery (2),
    debug (3)
}
</code></pre>
<p>Multiple TCB Info payloads, each associated with a different component in the layer, can be put together into the same certificate using a <code>DiceTcbInfoSeq</code>:</p>
<pre><code class="language-asn.1">tcg-dice-MultiTcbInfo OBJECT IDENTIFIER ::= { tcg-dice 5 }

DiceTcbInfoSeq ::= SEQUENCE SIZE (1..MAX) OF DiceTcbInfo
</code></pre>
<p>Even though further extensions have been defined (for the full list see Section 6.1 of <a href="https://trustedcomputinggroup.org/resource/dice-attestation-architecture/">"Attestation Architecture"</a> -- for example one that allows unsigned <a href="https://datatracker.ietf.org/doc/draft-ietf-rats-eat/">EAT</a> claims to be embedded in an X.509 extension -- <code>DiceTcbInfo</code> is the (currently) preferred way.</p>
<h3 id="open-dice-formats"><a class="header" href="#open-dice-formats">Open DICE Formats</a></h3>
<p>In Open DICE, the equivalent of the TCB Info is called <code>OpenDiceInput</code> and has a very regular layout, with data and metadata for code, configuration and authority respectively:</p>
<pre><code class="language-asn.1">Mode ::= INTEGER (0..3)

OpenDiceInput ::= SEQUENCE {
  codeHash                [0] EXPLICIT OCTET STRING OPTIONAL,
  codeDescriptor          [1] EXPLICIT OCTET STRING OPTIONAL,
  configurationHash       [2] EXPLICIT OCTET STRING OPTIONAL,
  configurationDescriptor [3] EXPLICIT OCTET STRING OPTIONAL,
  authorityHash           [4] EXPLICIT OCTET STRING OPTIONAL,
  authorityDescriptor     [5] EXPLICIT OCTET STRING OPTIONAL,
  mode                    [6] EXPLICIT Mode OPTIONAL,
}
</code></pre>
<p>For further details regarding the Open DICE X.509 profile, see the <a href="https://pigweed.googlesource.com/open-dice/+/HEAD/docs/specification.md#certificate-details">Certificate Details</a> section of the spec.</p>
<p>Open DICE also allows encoding UDS and CDI certificates in <a href="https://pigweed.googlesource.com/open-dice/+/HEAD/docs/specification.md#CBOR-UDS-Certificates">CBOR Web Tokens (CWT)</a> similar to <a href="https://datatracker.ietf.org/doc/draft-ietf-rats-eat/">EAT</a>.   It also allows for hybrid cert chains, with co-existing X.509 and CWT certs in the same logical chain, to support legacy component integrations.</p>
<h2 id="dice-from-a-veraisons-perspective"><a class="header" href="#dice-from-a-veraisons-perspective">DICE from a Veraison's Perspective</a></h2>
<p>Miscellaneous implementation &amp; deployment considerations.</p>
<h3 id="asymmetric-crypto-identities"><a class="header" href="#asymmetric-crypto-identities">Asymmetric Crypto Identities</a></h3>
<p>Typically, DICE identities are associated with asymmetric key pairs.</p>
<blockquote>
<p>NOTE: This mode is, from a security perspective, the most desirable.  In fact, when using public keys for verification, the verifier only needs to take care of their availability and integrity.</p>
</blockquote>
<p>Effectively a verifier only stores the device trust anchor, which could be an external root CA -- for example the ODM's -- or the self-signed certificate of the device in case there is no external CA to anchor the cert chain.  The former providing a much more scalable solution, with individual device revocation handled via standard CRLs.</p>
<h3 id="symmetric-crypto-identities"><a class="header" href="#symmetric-crypto-identities">Symmetric Crypto Identities</a></h3>
<p>"Symmetric Identity Based Device Attestation" describes how to associate DICE identities with symmetric crypto keys.</p>
<p>In this case, the verifier must have a-priori knowledge of the device secret as well as a detailed understanding of the identity derivation algorithm in order to verify the device's authenticated assertions.  This assumes a level of coupling between attesters and verifiers that, I reckon, is not achievable using only the available TCG standards, which tend to be quite liberal around the implementation details.  The Open-DICE specification only allows identities based on asymmetric keys.</p>
<blockquote>
<p>NOTE: This mode shifts all the costs on the verification infra.  It is an operational nightmare with a vast attack surface and very limited scalability.  It should be deemed acceptable only when the cost of a key compromise / disclosure is (very) low, and the device fleet is roughly static with very infrequent software updates.</p>
</blockquote>
<h3 id="verification"><a class="header" href="#verification">Verification</a></h3>
<p>We expect that, typically, DICE evidence submitted for verification is not bound to an explicit challenge-response session.  This is likely to require defining a new Veraison API alongside the existing <a href="services/schemes/api/challenge-response/README.html">challenge-response</a> endpoint.</p>
<p>Given the fact that TCG DICE has a few loose ends, mainly in terms of evidence encoding formats and the nature of cryptographic identities, Veraison will have to be as flexible as possible while clearly documenting the supported feature set.</p>
<p>Open-DICE defines a stricter (and smaller) set of requirements and therefore it'd be probably easier to implement fully.</p>
<p>Veraison <a href="https://github.com/veraison/dice">DICE implementation</a> will need to be extended with APIs for claims extraction.  The existing certificate chain verification API should be OK as-is.</p>
<h3 id="endorsements-provisioning"><a class="header" href="#endorsements-provisioning">Endorsements Provisioning</a></h3>
<p>By definition, native CoRIM fully supports TCG DICE, so there should be no extra work needed to profile the <a href="https://github.com/veraison/corim">corim</a> API, which already implements the entirety of CoRIM.</p>
<p>Open-DICE has a slightly different description of the TCB which will need to be reflected in a CoRIM profile.  It should be a pretty straightforward operation.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="policies"><a class="header" href="#policies">Policies</a></h1>
<p>Policies allow tenants to perform additional evaluation of attestation
evidence that is not covered by a particular attestation scheme. The policy can
be used to override the overall attestation status and/or the trust vector
values in the result (e.g. rejecting a token considered valid by the scheme if
the more stringent constraints described in the policy are not met).</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Policy administration framework is to be determined in the future. The
short-term plan is to make this a part of the deployment flow, but a more
complete policy admin flow may follow.</p>
</div>
<p>The syntax of the policy depends on the agent used to evaluate it. At the
moment, the following policy agents are supported:</p>
<p>"opa" -- <a href="https://www.openpolicyagent.org/">Open Policy Agent</a> is a flexible,
generic Open Source policy agent that utilizes its own policy language called
Rego. See <a href="services/README.opa.html">README.opa.md</a>.</p>
<h2 id="configuration-2"><a class="header" href="#configuration-2">Configuration</a></h2>
<p>Configuration for the policy agent is specified under top-level entry
<code>po-agent</code>.</p>
<h3 id="po-agent-configuration-1"><a class="header" href="#po-agent-configuration-1"><code>po-agent</code> configuration</a></h3>
<p>The following policy agent configuration directives are currently supported:</p>
<ul>
<li><code>backend</code>: specified which policy backend will be used. Currently supported
backends: <code>opa</code>.</li>
<li><code>&lt;backend name&gt;</code>: an entry with the name of a backend is used to specify
configuration for that backend. Multiple such entries may exist in a single
config, but only the one for the backend specified by the <code>backend</code> directive
will be used.</li>
</ul>
<h4 id="opa-backend-configuration-1"><a class="header" href="#opa-backend-configuration-1"><code>opa</code> backend configuration</a></h4>
<p>Currently, <code>opa</code> backend does not support any configuration.</p>
<h2 id="policy-identification"><a class="header" href="#policy-identification">Policy Identification</a></h2>
<p>There are three different ways of identifying a policy:</p>
<h3 id="appraisal-policy-id"><a class="header" href="#appraisal-policy-id">appraisal policy ID</a></h3>
<p>This is an identifier used in the attestation result as defined by <a href="https://www.ietf.org/archive/id/draft-fv-rats-ear-01.html#name-ear-appraisal-claims">EAR
Internet draft</a>.
Note that in this case, "policy" is used in the sense of "Appraisal Policy for
Evidence" as per <a href="https://www.rfc-editor.org/rfc/rfc9334">RATS architecture</a>.
In Veraison, this encompasses both, the scheme, and the policy applied from the
policy store by a policy engine.</p>
<p>An appraisal policy ID is a <a href="https://www.rfc-editor.org/rfc/rfc3986">URI</a> with
the scheme <code>policy</code> followed by a rootless path indicating the (RATS) policy
using which the appraisal has been generated. The first segment of the path is
the name of the scheme used to create the appraisal. The second segment, if
present, is the individual policy ID (see below) of the policy that has been
applied to the appraisal created by the scheme.</p>
<p>For example:</p>
<ul>
<li><code>policy:TPM_ENACTTRUST</code>: the appraisal has been created using "TPM_ENACTTRUST" scheme, with
no additional policy applied.</li>
<li><code>policy:PSA_IOT/340d22f7-9eda-499f-9aa2-5af295d6d812</code>: the appraisal has been
created using "PSA_IOT" scheme and has subsequently been updated by the
policy with unique policy ID "ae19cc27-a449-1fb8-6c10-00f47ad1c55c".</li>
</ul>
<h4 id="potential-future-extensions"><a class="header" href="#potential-future-extensions">Potential future extensions</a></h4>
<p>These indicate potential future enhancements, and are <strong>not</strong> supported by the
current implementation.</p>
<h5 id="cascading-policies"><a class="header" href="#cascading-policies">Cascading policies</a></h5>
<p>In the future we may support applying multiple individual policies to a single
appraisal. In that case, each path segment after the first (the scheme) is the
individual policy ID of a policy that has been applied. The ordering of the
segments matches the order in which the policies were applied.</p>
<p>For example:</p>
<ul>
<li><code>policy:PSA_IOT/340d22f7-9eda-499f-9aa2-5af295d6d812/ae19cc27-a449-1fb8-6c10-00f47ad1c55c</code>:
the appraisal has been created using "PSA_IOT" scheme, it was then updated by
a policy with the individual policy id
<code>340d22f7-9eda-499f-9aa2-5af295d6d812</code>, followed by a policy with the
individual policy ID <code>ae19cc27-a449-1fb8-6c10-00f47ad1c55c</code>.</li>
</ul>
<h3 id="policy-store-key"><a class="header" href="#policy-store-key">policy store key</a></h3>
<p>Policies are stored, retrieved from, and updated in the policy store using a key.
The key is a string consisting of the tenant id, scheme, and policy name
delimited by colons.</p>
<p>For example:</p>
<ul>
<li><code>0:PSA_IOT:opa</code>: the key for tenant "0"'s policy for scheme "PSA_IOT" with
name "opa".</li>
</ul>
<h4 id="policy-name"><a class="header" href="#policy-name">policy name</a></h4>
<p>The name exists to support cascading policies in the future (see above). At the
moment, as there is only one active policy allowed per appraisal, the name is
not necessary and is always set to the name of the policy engine ("opa"). While
this unnecessarily increases the key size and is somewhat wasteful, given that
the number of the policies a typical deployment is expected to be, at most, in
the hundreds, and the relatively negligible overhead compared to the size of
the policies themselves, this is not deemed to be a major concern.</p>
<h3 id="individual-policy-id"><a class="header" href="#individual-policy-id">individual policy ID</a></h3>
<p>The individual policy ID identifies the specific policy that was applied to an
appraisal. It forms a component of the appraisal policy ID (which also includes
the scheme, and possibly, in the future, individual IDs from multiple
policies). It differs from the policy store key in that it also incorporates
versioning information.</p>
<p>The individual policy id is the UUID of the specific policy instance.</p>
<p>For example: <code>340d22f7-9eda-499f-9aa2-5af295d6d812</code></p>
<h2 id="writing-policies"><a class="header" href="#writing-policies">Writing Policies</a></h2>
<p>Please see the OPA <a href="https://www.openpolicyagent.org/docs/latest/">official
documentation</a> for information on
how to write Rego policies. This section describes what is necessary to
implement a valid Veraison policy, and assumes a general familiarity with Rego.</p>
<h3 id="package-declaration"><a class="header" href="#package-declaration">Package declaration</a></h3>
<p>Your policy should specify <code>policy</code> as the package.</p>
<pre><code class="language-rego">package policy
</code></pre>
<h3 id="evaluation-data"><a class="header" href="#evaluation-data">Evaluation Data</a></h3>
<p>Data to be evaluated is defined as the following variables in the <code>policy</code>
package:</p>
<p><code>evidence</code> contains the JSON representation of <code>proto.EvidenceContext.Evidence</code>
structure. This is the scheme-specific values extracted from the attestation
token.</p>
<p><code>endorsements</code> is an array of endorsement JSON objects. Their structure is
scheme-specific.</p>
<p><code>result</code> is a JSON object representing <code>proto.AttestationResult</code> that was
generated by the scheme.</p>
<p><code>scheme</code> is the name of the attestation scheme.</p>
<h3 id="rules"><a class="header" href="#rules">Rules</a></h3>
<p>You can update the attestation result by defining one or more of the following
rules:</p>
<ul>
<li><code>status</code></li>
<li><code>hw_authenticity</code></li>
<li><code>sw_integrity</code></li>
<li><code>sw_up_to_dateness</code></li>
<li><code>config_integrity</code></li>
<li><code>runtime_integrity</code></li>
<li><code>certification_status</code></li>
</ul>
<p>The first overwrites the overall attestation result status. The subsequent rules
overwrite the corresponding entries in the trust vector.</p>
<p>The rules must be defined such that they produce the string <code>"SUCCESS"</code> if the
conditions have been met, and the string <code>"FAILURE"</code> otherwise.</p>
<p>As various versions are often represented using Semantic Versioning, <code>policy</code>
package provides a utility function, <code>semver_cmp</code> to aid in their comparison
(note: currently, pre-release suffixes are not supported).</p>
<p>For example:</p>
<pre><code class="language-rego">sw_integrity = "SUCCESS" {
    # note: This is an example. The evidence entries do not correspond to any
    #       actual scheme.
    evidence["application-hash"] == "h0KPxSKAPTEGXnvOPPA/5HUJZjHl4Hu9eg/eYMTPJcc="
    evidence["firmware-hash"] == "h0KPxSKAPTEGXnvOPPA/5HUJZjHl4Hu9eg/eYMTPJcc="
    semver_cmp(evidence["firmware-version"], "1.2.0") &gt;= 0
} else = "FAILURE"
</code></pre>
<h4 id="dealing-with-multiple-attestation-schemes"><a class="header" href="#dealing-with-multiple-attestation-schemes">Dealing With Multiple Attestation Schemes</a></h4>
<p>If you expect your policy to be applied to inputs from multiple attestation
schemes, you differentiate between them using the <code>format</code> variable defined by
the <code>policy</code> package. For example you can define rules for each scheme, and
then alias the generic rules above to one of them based on the value of the
<code>format</code> variable. For example:</p>
<pre><code class="language-rego">sw_up_to_dateness = psa_sw_up_to_dateness { format == "PSA_IOT" }
             else = enacttrust_sw_up_to_dateness { format == "TPM_ENACTTRUST" }

psa_sw_up_to_dateness = "SUCCESS" {
    # ...
} else = "FAILURE"

enacttrust_sw_up_to_dateness = "SUCCESS" {
    # ...
} else = "FAILURE"
</code></pre>
<h3 id="example-policy"><a class="header" href="#example-policy">Example Policy</a></h3>
<p>This is a example of a policy that sets the <code>SoftwareUpToDateness</code> value in the
trust vector for <code>PSA_IOT</code> and <code>TPM_ENACTTRUST</code> schemes (neither scheme has
built-in definition for software up-to-dateness, and so that entry is undefined
in the results generated by the schemes).</p>
<pre><code class="language-rego">package policy

# Use the psa_sw_up_to_dateness rules iff the attestation format is PSA_IOT, and
# to enacttrust_sw_up_to_dateness iff the format is TPM_ENACTTRUST, otherwise,
# sw_up_to_dateness will remain undefined.
sw_up_to_dateness = psa_sw_up_to_dateness { format == "PSA_IOT" }
             else = enacttrust_sw_up_to_dateness { format == "TPM_ENACTTRUST" }

# This sets sw-up-to-dateness trust vector value to success iff BL version is
# 3.5 or greater, and to failure otherwise.
psa_sw_up_to_dateness = "SUCCESS" {
  # there exisists some i such that...
  some i
  # ...the i'th software component has type "BL", and...
  evidence["psa-software-components"][i]["measurement-type"] == "BL"

  # ...the version of this component is greater or equal to 3.5.
  # (semver_cmp is defined by the policy package. It returns 1 if the first
  # parameter is greater than the second, -1 if it is less than the second,
  # and 0 if they are equal.)
  semver_cmp(evidence["psa-software-components"][i].version, "3.5") &gt;= 0
} else = "FAILURE" # unless the above condition is met, return "FAILURE"

# Unlike the PSA token, the EnactTrust token does not include information about
# multiple sofware componets and instead has a single "firmware" entry.
enacttrust_sw_up_to_dateness = "SUCCESS" {
  evidence["firmware"] &gt;= 8
} else = "FAILURE"
</code></pre>
<h2 id="managing-policies"><a class="header" href="#managing-policies">Managing Policies</a></h2>
<p>Policies can be added to, and later managed in, the service using <a href="https://github.com/veraison/pocli"><code>pocli</code>
command line tool</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="api"><a class="header" href="#api">API</a></h1>
<p>This chapter documents the REST API exposed by Veraison services. These API are
grouped into three categories:</p>
<ul>
<li>Provisioning of endorsements and trust anchors.</li>
<li>Challenge/response for verifying attestation evidence.</li>
<li>Management of verification policies.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="endorsement-provisioning-interface"><a class="header" href="#endorsement-provisioning-interface">Endorsement Provisioning Interface</a></h1>
<p>The API described here are can be used to provision
Endorsements into a Verifier. The API are agnostic with regards to
the specific data model used to transport Endorsements. HTTP Content negotiation is used to determine the precise message structure and format of the information exchanged between the clients and the server.
One specific example of information exchange using
<a href="https://datatracker.ietf.org/doc/draft-birkholz-rats-corim/">Concise Reference Integrity Manifest (CoRIM)</a> is given below.</p>
<h2 id="provisioning-api"><a class="header" href="#provisioning-api">Provisioning API</a></h2>
<p>The provisioning API allows authorized supply chain actors to communicate reference and endorsed values,
verification and identity key material, as well as other kinds of endorsements to Veraison. The supported
format is CoRIM.</p>
<ul>
<li>To initiate a provisioning session, a client <code>POST</code>'s the CoRIM containing the endorsements to be provisioned to the <code>/submit</code> URL.</li>
<li>If the transaction completes synchronously, a <code>200</code> response is returned to the client to indicate the
submission of the posted CoRIM has been fully processed.  The response body contains a "session" resource whose <code>status</code> field encodes the outcome of the submission (see below).</li>
<li>The provisioning processing may also happen asynchronously, for example when submitting a large CoRIM. In this case,
the server returns a <code>201</code> response, with a <code>Location</code> header pointing to a session resource that the client can regularly poll to monitor any change in the status of its request.</li>
<li>A session starts in <code>processing</code> state and ends up in one of <code>success</code> or <code>failed</code>. When in <code>failed</code> state, the <code>failure-reason</code> field of the session resource contains details about the error condition.</li>
<li>The session resource has a defined time to live: upon its expiry, the resource is garbage collected.  Alternatively, the client can dispose the session resource by issuing a <code>DELETE</code> to the resource URI.</li>
</ul>
<h2 id="synchronous-submission"><a class="header" href="#synchronous-submission">Synchronous submission</a></h2>
<pre><code class="language-text"> o        (1) POST           .-------------.
/|\ ------------------------&gt;| /submit     |
/ \ &lt;------------------------|             |
            200 (OK)         '-------------' 
            { "status": "success|failed" }
</code></pre>
<ul>
<li>Client submits the endorsement provisioning request</li>
<li>Server responds with response code <code>200</code> indicating processing is complete.
The response body contains a session resource with a <code>status</code> indicating the outcome of the submission operation.</li>
</ul>
<h3 id="example-of-a-successful-submission"><a class="header" href="#example-of-a-successful-submission">Example of a successful submission</a></h3>
<pre><code class="language-text">&gt;&gt; Request:
  POST /endorsement-provisioning/v1/submit
  Host: veraison.example
  Content-Type: application/rim+cbor

  ...CoRIM as binary data...

&lt;&lt; Response:
  HTTP/1.1 200 OK
  Content-Type: application/vnd.veraison.provisioning-session+json

  {
    "status": "success",
    "expiry": "1970-01-01T00:00:00Z"
  }
</code></pre>
<h3 id="example-of-a-failed-submission"><a class="header" href="#example-of-a-failed-submission">Example of a failed submission</a></h3>
<pre><code class="language-text">&gt;&gt; Request:
  POST /endorsement-provisioning/v1/submit
  Host: veraison.example
  Content-Type: application/rim+cbor

  ...CoRIM as binary data...

&lt;&lt; Response:
  HTTP/1.1 200 OK
  Content-Type: application/vnd.veraison.provisioning-session+json

  {
    "status": "failed",
    "failure-reason": "invalid signature",
    "expiry": "1970-01-01T00:00:00Z"
  }
</code></pre>
<h2 id="asynchronous-submission"><a class="header" href="#asynchronous-submission">Asynchronous submission</a></h2>
<pre><code class="language-text"> o        (1) POST           .-------------.
/|\ ------------------------&gt;| /submit     |
/ \ \ &lt;----------------------|             |
   \ \      201 Created      '-------------'
    \ \     Location: /session/01   |
     \ \                            V
      \ \  (2) GET           .-------------.
       \ '------------------&gt;| /session/01 |
        `&lt;-------------------|             |
             200 OK          '-------------'
             { "status": "processing|success|failed" }
</code></pre>
<ul>
<li>Client submits the endorsement provisioning request</li>
<li>Server responds with response code <code>201</code> indicating that the request has been accepted and will be processed asynchronously</li>
<li>Server returns the URI of a time-bound session resource in the <code>Location</code> header. The resource can be polled at regular intervals to check the progress of the submission, until the processing is complete (either successfully or with a failure)</li>
</ul>
<h3 id="example-1"><a class="header" href="#example-1">Example</a></h3>
<pre><code class="language-text">&gt;&gt; Request:
  POST /endorsement-provisioning/v1/submit
  Host: veraison.example
  Content-Type: application/rim+cbor

...CoRIM as binary data...
  
&lt;&lt; Response:
  HTTP/1.1 201 Created
  Content-Type: application/vnd.veraison.provisioning-session+json
  Location: /endorsement-provisioning/v1/session/1234567890

  {
    "status": "processing",
    "expiry": "2030-10-12T07:20:50.52Z"
  }
</code></pre>
<pre><code class="language-text">&gt;&gt; Request:
  GET /endorsement-provisioning/v1/session/1234567890
  Host: veraison.example
  Accept: application/vnd.veraison.provisioning-session+json

&lt;&lt; Response:
  HTTP/1.1 200 OK
  Content-Type: application/vnd.veraison.provisioning-session+json

  {
    "status": "success",
    "expiry": "2030-10-12T07:20:50.52Z"
  }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="challengeresponse"><a class="header" href="#challengeresponse">Challenge/Response</a></h1>
<h2 id="interaction-models"><a class="header" href="#interaction-models">Interaction models</a></h2>
<p>The APIs described here are meant to be instantiations of the abstract
protocols described in <a href="https://datatracker.ietf.org/doc/draft-ietf-rats-reference-interaction-models/">Reference Interaction Models for Remote Attestation
Procedures</a>.</p>
<h2 id="session-flow"><a class="header" href="#session-flow">Session flow</a></h2>
<p>Each Challenge-Response session is associated to its own resource, with the
following attributes:</p>
<ul>
<li>The session nonce;</li>
<li>An expiry date after which the session is garbage collected;</li>
<li>The accepted MIME types for Evidence to submit;</li>
<li>The session state (<code>waiting</code> -&gt; <code>processing</code> -&gt; <code>complete</code> | <code>failed</code>)</li>
<li>The submitted Evidence;</li>
<li>The produced Attestation Result.</li>
</ul>
<p>The resource is created in response to a client <code>POST</code> (1).  Subsequently, the
client interacts with its session resource by <code>POST</code>ing Evidence to verify (2),
and possibly polling it until the Attestation Result pops up (3).  In (2), the
server may decide to reply synchronously by including the Attestation Result
directly in the response.  In such case, (3) is not necessary.  The optional
cleanup step in (4) allows a client to explicitly destroy the session resource.
In any case the resource is garbage collected at any point in time after the
session expiry has elapsed.</p>
<pre><code> o        (1) POST           .-------------.
/|\ ------------------------&gt;| /newSession |
/ \ \                        '------+------'
 \ \ \                              |
  \ \ \                             V
   \ \ \  (2) POST Evidence  .-------------.
    \ \ '-------------------&gt;| /session/01 |
     \ \                     '-------------'
      \ \                        ^  ^
       \ \    (3) GET            |  |
        \ '----------------------'  |
         \     (4) DELETE           |
          '-------------------------'
</code></pre>
<h3 id="session-setup"><a class="header" href="#session-setup">Session setup</a></h3>
<ul>
<li>To start a new session and obtain a time-bounded nonce value:</li>
</ul>
<pre><code>&gt;&gt; Request:
  POST /challenge-response/v1/newSession?nonceSize=32
  Host: veraison.example
  Accept: application/vnd.veraison.challenge-response-session+json

&lt;&lt; Response:
  HTTP/1.1 201 Created
  Content-Type: application/vnd.veraison.challenge-response-session+json
  Location: https://veraison.example/challenge-response/v1/session/1234567890

  {
    "nonce": "MTIzNDU2Nzg5MDEyMzQ1Njc4OTAxMjM0NTY3ODkwMTI=",
    "expiry": "2030-10-12T07:20:50.52Z",
    "accept": [
      "application/psa-attestation-token"
    ],
    "state": "waiting"
  }
</code></pre>
<p><code>nonceSize</code> must be between <code>8</code> and <code>64</code>. Analogously, <code>nonce</code> must be between
8 and 64 bytes when decoded (which means the specified base64 string must be no
longer than 88 bytes).</p>
<h3 id="asynchronous-verification"><a class="header" href="#asynchronous-verification">Asynchronous verification</a></h3>
<ul>
<li>Submit evidence for this session:</li>
</ul>
<pre><code>&gt;&gt; Request:
  POST /challenge-response/v1/session/1234567890
  Host: veraison.example
  Accept: application/vnd.veraison.challenge-response-session+json
  Content-Type: application/psa-attestation-token

  .....

&lt;&lt; Response:
  HTTP/1.1 202 Accepted
  Content-format: application/vnd.veraison.challenge-response-session+json

  {
    "nonce": "MTIzNDU2Nzg5MDEyMzQ1Njc4OTAxMjM0NTY3ODkwMTI=",
    "expiry": "2031-10-12T07:20:50.52Z",
    "accept": [
      "application/psa-attestation-token"
    ],
    "state": "processing",
    "evidence": {
      "type": "application/psa-attestation-token",
      "value": "eyJhbGciO...RfrKmTWk"
    }
  }
</code></pre>
<ul>
<li>Since we got back a 202, we need to poll for result:</li>
</ul>
<pre><code>&gt;&gt; Request:
  GET /challenge-response/v1/session/1234567890
  Host: veraison.example
  Accept: application/vnd.veraison.challenge-response-session+json

&lt;&lt; Response:
  HTTP/1.1 200 OK
  Content-format: application/vnd.veraison.challenge-response-session+json

  {
    "nonce": "MTIzNDU2Nzg5MDEyMzQ1Njc4OTAxMjM0NTY3ODkwMTI=",
    "expiry": "2031-10-12T07:20:50.52Z",
    "accept": [
      "application/psa-attestation-token"
    ],
    "state": "complete",
    "evidence": {
      "type": "application/psa-attestation-token",
      "value": "eyJhbGciO...RfrKmTWk"
    },
    "result": {
      "is_valid": true,
      "claims": {
        // ...
      }
    }
  }
</code></pre>
<h3 id="synchronous-verification"><a class="header" href="#synchronous-verification">Synchronous verification</a></h3>
<ul>
<li>Submit evidence for this session and obtain the attestation result right away
(200):</li>
</ul>
<pre><code>&gt;&gt; Request:
  POST /challenge-response/v1/session/1234567890
  Host: veraison.example
  Accept: application/vnd.veraison.challenge-response-session+json
  Content-Type: application/psa-attestation-token

  .....

&lt;&lt; Response:
  HTTP/1.1 200 OK
  Content-format: application/vnd.veraison.challenge-response-session+json

  {
    "nonce": "MTIzNDU2Nzg5MDEyMzQ1Njc4OTAxMjM0NTY3ODkwMTI=",
    "expiry": "2030-10-12T07:20:50.52Z",
    "accept": [
      "application/psa-attestation-token"
    ],
    "state": "complete",
    "evidence": {
      "type": "application/psa-attestation-token",
      "value": "eyJhbGciO...RfrKmTWk"
    },
    "result": {
      "is_valid": true,
      "claims": {
        // ...
      }
    }
  }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="policy-management"><a class="header" href="#policy-management">Policy management</a></h1>
<p>Policies allow augmenting attestation scheme generated <a href="https://www.rfc-editor.org/rfc/internet-drafts/draft-fv-rats-ear-00.html">Attestation Results</a> on
per-deployment basis, by specifying additional rules to be applied to these
results. This may result in the change of the trust vector values (and,
correspondingly, the overall result status), and/or addition of supplementary
claims under the <code>policy-added-claims</code> EAR extension.</p>
<p>A policy is defined by a text document describing the rules to be applied by
the policy engine. Currently, Veraison only support the OPA policy engine.
Correspondingly, policies must be written in Rego language used by OPA. See
<a href="https://github.com/veraison/services/blob/main/policy/README.opa.md#rules">OPA policy README</a> in services repo for details.</p>
<p>During verification, the active policy for attestation scheme/tenant
combination is retrieved. Currently, only one policy per scheme/tenant may be
active at a time.</p>
<p>The policy management API exposes each scheme's policy via a unique resource
path in the form <code>/policy/v1/{scheme}</code>. It supports the basic CRUD operations,
typical to any resource management, in the following way:</p>
<ul>
<li><strong>create</strong>: A new policy is added to a scheme via a POST request to its path.</li>
<li><strong>read</strong>: Policy can be retrieved via a GET request to its path.</li>
<li><strong>update</strong>: A direct update is not possible, however a new policy can be
added and activated. Activating the new policy will deactivate
the old one, effectively replacing it.</li>
<li><strong>delete</strong>: True deletion is not possible. This allows retrieval of the
specific policy version that was used to generate an attestation
result. However, all policies may be deactivated, resulting in no
policy being used during verification.</li>
</ul>
<h2 id="rest-api"><a class="header" href="#rest-api">REST API</a></h2>
<h3 id="adding-a-new-policy"><a class="header" href="#adding-a-new-policy">Adding a new policy</a></h3>
<ul>
<li>A policy is added for a new scheme (with tenant implicit via auth).</li>
<li>Optionally, a name for the policy may be specified via query arguments. If a
name is not specified, the default name of <code>"default"</code> will be used.</li>
<li>On success, the new policy object is returned, with Location header set to
its unique URI.</li>
<li>The newly added policy is inactive. It must be activated via  a separate
request (see below).</li>
</ul>
<h4 id="request"><a class="header" href="#request">Request:</a></h4>
<pre><code class="language-http">POST /management/v1/policy/PSA_IOT&amp;name=base HTTP/1.1
Host: veraison.example
Content-Type: application/vnd.veraison.policy.opa
Accept: application/vnd.veraison.policy+json

hardware = "AFFIRMING" {
    // secured state
    state := bits.rsh(bits.and(evidence["psa-security-lifecycle"], 0xFFFF0000), 8)
    state &gt;= 0x3000
    state &lt;= 0x30FF
} else = "CONTRAINDICATED"
</code></pre>
<h4 id="response"><a class="header" href="#response">Response:</a></h4>
<pre><code class="language-http">HTTP/1.1 201 Created
Content-Type: application/vnd.veraison.policy+json
Location: /management/v1/policy/PSA_IOT/340d22f7-9eda-499f-9aa2-5af295d6d812

{
  "type": "opa",
  "name": "base",
  "uuid": "340d22f7-9eda-499f-9aa2-5af295d6d812",
  "active": false,
  "ctime": "2023-07-06 00:00:00",
  "rules": "hardware = \"AFFIRMING\" {\n          // secured state\n          state := bits.rsh(bits.and(evidence[\"psa-security-lifecycle\"], 0xFFFF0000), 8)\n          state &gt;= 0x3000\n          state &lt;= 0x30FF\n      } else = \"CONTRAINDICATED\"\n  }"
}
</code></pre>
<h3 id="retrieving-a-specific-policy-object"><a class="header" href="#retrieving-a-specific-policy-object">Retrieving a specific policy object</a></h3>
<p>A policy may be retrieved via its unique URI.</p>
<h4 id="request-1"><a class="header" href="#request-1">Request:</a></h4>
<pre><code class="language-http">GET /management/v1/policy/PSA_IOT/340d22f7-9eda-499f-9aa2-5af295d6d812 HTTP/1.1
Host: veraison.example
Accept: application/vnd.veraison.policy+json
</code></pre>
<h4 id="response-1"><a class="header" href="#response-1">Response:</a></h4>
<pre><code class="language-http">HTTP/1.1 200 OK
Content-Type: application/vnd.veraison.policy+json

{
  "type": "opa",
  "name": "base",
  "uuid": "340d22f7-9eda-499f-9aa2-5af295d6d812",
  "active": false,
  "ctime": "2023-07-06 00:00:00",
  "rules": "hardware = \"AFFIRMING\" {\n          // secured state\n          state := bits.rsh(bits.and(evidence[\"psa-security-lifecycle\"], 0xFFFF0000), 8)\n          state &gt;= 0x3000\n          state &lt;= 0x30FF\n      } else = \"CONTRAINDICATED\"\n  }"
}
</code></pre>
<h3 id="retrieving-the-active-policy-object"><a class="header" href="#retrieving-the-active-policy-object">Retrieving the active policy object</a></h3>
<p>The active policy object for a scheme may be retrieved by omitting the UUID.</p>
<h4 id="request-2"><a class="header" href="#request-2">Request:</a></h4>
<pre><code class="language-http">GET /management/v1/policy/PSA_IOT HTTP/1.1
Host: veraison.example
Accept: application/vnd.veraison.policy+json
</code></pre>
<h4 id="response-2"><a class="header" href="#response-2">Response:</a></h4>
<pre><code class="language-http">HTTP/1.1 200 OK
Content-Type: application/vnd.veraison.policy+json

{
  "type": "opa",
  "name": "base",
  "uuid": "ae19cc27-a449-1fb8-6c10-00f47ad1c55c",
  "active": true,
  "ctime": "2023-07-06 00:00:00",
  "rules": "hardware = \"AFFIRMING\"  // always affirm"
}
</code></pre>
<h3 id="retrieving-all-policy-objects-for-a-scheme"><a class="header" href="#retrieving-all-policy-objects-for-a-scheme">Retrieving all policy objects for a scheme</a></h3>
<p>Optionally, a name query param may be used to filter the result and only return
policies for the scheme associated with the specified name.</p>
<h4 id="request-3"><a class="header" href="#request-3">Request:</a></h4>
<pre><code class="language-http">GET /management/v1/policies/PSA_IOT&amp;name=base HTTP/1.1
Host: veraison.example
Accept: application/vnd.veraison.policy+json
</code></pre>
<h4 id="response-3"><a class="header" href="#response-3">Response:</a></h4>
<pre><code class="language-http">HTTP/1.1 200 OK
Content-Type: application/vnd.veraison.policies+json

[
  {
    "type": "opa",
    "name": "base",
    "uuid": "ae19cc27-a449-1fb8-6c10-00f47ad1c55c",
    "active": true,
    "ctime": "2023-07-06 00:00:00",
    "rules": "hardware = \"AFFIRMING\"  // always affirm"
  },
  {
    "type": "opa",
    "name": "base",
    "uuid": "340d22f7-9eda-499f-9aa2-5af295d6d812",
    "active": false,
    "ctime": "2023-07-06 00:00:00",
    "rules": "hardware = \"AFFIRMING\" {\n          // secured state\n          state := bits.rsh(bits.and(evidence[\"psa-security-lifecycle\"], 0xFFFF0000), 8)\n          state &gt;= 0x3000\n          state &lt;= 0x30FF\n      } else = \"CONTRAINDICATED\"\n  }"
  }
]
</code></pre>
<h3 id="activate-a-policy"><a class="header" href="#activate-a-policy">Activate a policy</a></h3>
<p>Set a given policy to become the active one. This operation atomically
deactivates any previously active policy for the scheme.</p>
<h4 id="request-4"><a class="header" href="#request-4">Request:</a></h4>
<pre><code class="language-http">POST /management/v1/policy/PSA_IOT/340d22f7-9eda-499f-9aa2-5af295d6d812/activate HTTP/1.1
Host: veraison.example
</code></pre>
<h4 id="response-4"><a class="header" href="#response-4">Response:</a></h4>
<pre><code class="language-http">HTTP/1.1 200 OK
</code></pre>
<h3 id="deactivate-all-policies"><a class="header" href="#deactivate-all-policies">Deactivate all policies</a></h3>
<h4 id="request-5"><a class="header" href="#request-5">Request:</a></h4>
<pre><code class="language-http">POST /management/v1/policies/PSA_IOT/deactivate HTTP/1.1
Host: veraison.example
</code></pre>
<h4 id="response-5"><a class="header" href="#response-5">Response:</a></h4>
<pre><code class="language-http">HTTP/1.1 200 OK
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="endorsement-and-reference-value-provisioning"><a class="header" href="#endorsement-and-reference-value-provisioning">Endorsement and Reference Value Provisioning</a></h1>
<h2 id="concise-reference-integrity-manifest"><a class="header" href="#concise-reference-integrity-manifest">Concise Reference Integrity Manifest</a></h2>
<p>The Concise Reference Integrity Manifest (CoRIM) is a format for representing
Endorsements and Reference Values as defined by the <a href="https://www.ietf.org/rfc/rfc9334.html">RATS
architecture</a>. See <a href="https://datatracker.ietf.org/doc/draft-ietf-rats-corim/07/">this IETF
Draft</a> for the
detailed specification.</p>
<p>A Go implementation exists on
<a href="https://github.com/veraison/corim">GitHub</a>.</p>
<p>CoRIM is the format used for provisioning Endorsements and Reference Values by all attestation schemes currently supported by <a href="services/overview.html">Veraison Services</a>.</p>
<h2 id="concise-software-identification-tags"><a class="header" href="#concise-software-identification-tags">Concise Software Identification Tags</a></h2>
<p>Concise Software Identification Tags (CoSWID) is a format for describing
software components (eg. a specific release of software, a patch, or an
installation bundle). The full specification is defined by
<a href="https://www.ietf.org/rfc/rfc9393.html">RFC9393</a>.</p>
<p>A Go implementation exists on
<a href="https://github.com/veraison/swid">GitHub</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="extending-corim"><a class="header" href="#extending-corim">Extending CoRIM</a></h1>
<p><a href="https://datatracker.ietf.org/doc/draft-ietf-rats-corim/04">CoRIM
specification</a>
may be extended by CoRIM Profiles documented in other specifications at well
defined points identified in the base CoRIM spec using CDDL extension sockets.
CoRIM profiles may</p>
<ol>
<li>Introduce new data fields to certain objects.</li>
<li>Further constrain allowed values for existing fields.</li>
<li>Introduce new type choices for fields whose values can be one of several
types.</li>
</ol>
<p>This implementation, likewise, allows dependent code to register extension
types. This is done via three distinct extension mechanisms:</p>
<ol>
<li>
<p>Structures that allow extensions embed an <code>Extensions</code> object, which allows
registering a user-provided struct. The user-provided struct can extend
their containing structures in two ways:</p>
<ul>
<li>the fields of the user-provided struct become additional fields in
the containing structure.</li>
<li>the user-provided struct may define additional constraints on the
containing structure by defining an appropriate validation method for it.</li>
</ul>
<p>This corresponds to the map-extension sockets in the spec.</p>
</li>
<li>
<p>Some fields may have values chosen from a set of pre-determined types (e.g., an
instance ID may be either a UUID or UEID). These (mostly) correspond to
type-choice sockets in the CoRIM spec. The set of allowed types for a field
may be extended by registering a factory function for a new type, using the
registration function associated with the type choice.</p>
</li>
<li>
<p>A couple of type-choice sockets (<code>$tag-rel-type-choice</code>,
<code>$corim-role-type-choice</code> and <code>$comid-role-type-choice</code>) define what, in
effect, are extensible enums. They allow providing additional values, rather
than types. This implementation provides registration functions for new
values for those types.</p>
</li>
</ol>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>CoRIM also "imports" CDDL from the CoSWID spec. Some of
these CoSWID CDDL definitions also feature extension sockets.
However, as they are defined in a different spec and are implemented
in the <a href="https://github.com/veraison/swid"><code>veraison/swid</code></a> library, they
cannot be extended using the extension feature provided in the CoRIM library.
The extension support in CoRIM library is applicable ONLY to CoRIM and CoMID
maps and type choices</p>
</div>
<h2 id="map-extensions"><a class="header" href="#map-extensions">Map Extensions</a></h2>
<p>Map extensions allow extending CoRIM and CoMID maps with additional keys,
effectively defining new fields for the corresponding structures. In the code
base, these can be identified by the embedded <code>Extensions</code> struct. Each
extensible type has a corresponding <code>extensions.Point</code>. These are:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Extended Type</th><th style="text-align: center">Extension Point(s)</th><th style="text-align: center">Parent Structure</th><th style="text-align: center">Where to Call RegisterExtensions()</th></tr></thead><tbody>
<tr><td style="text-align: center">comid.Comid</td><td style="text-align: center">comid.ExtComid</td><td style="text-align: center">comid.Comid (the top-level CoMID)</td><td style="text-align: center">On a comid.Comid instance (e.g. myComid.RegisterExtensions(extMap))</td></tr>
<tr><td style="text-align: center">comid.Entity</td><td style="text-align: center">comid.ExtEntity</td><td style="text-align: center">comid.Entity</td><td style="text-align: center">Usually indirect via myComid.RegisterExtensions(...) (the Comid sees it).</td></tr>
<tr><td style="text-align: center">comid.Triples</td><td style="text-align: center">comid.ExtTriples</td><td style="text-align: center">comid.Triples</td><td style="text-align: center">Typically indirect via myComid.RegisterExtensions(...).</td></tr>
<tr><td style="text-align: center">comid.Mval</td><td style="text-align: center">comid.ExtReferenceValue, comid.ExtEndorsedValue, comid.ExtMval</td><td style="text-align: center">comid.Mval (measurement-value in reference/endorsed)</td><td style="text-align: center">Usually indirect via myComid.RegisterExtensions(...).</td></tr>
<tr><td style="text-align: center">comid.FlagsMap</td><td style="text-align: center">comid.ExtReferenceValueFlags, comid.ExtEndorsedValueFlags, comid.ExtFlags</td><td style="text-align: center">comid.FlagsMap</td><td style="text-align: center">Typically indirect via myComid.RegisterExtensions(...).</td></tr>
<tr><td style="text-align: center">corim.UnsignedCorim</td><td style="text-align: center">corim.ExtUnsignedCorim</td><td style="text-align: center">corim.UnsignedCorim (the top-level CoRIM)</td><td style="text-align: center">On a corim.UnsignedCorim instance (e.g. myCorim.RegisterExtensions(...))</td></tr>
<tr><td style="text-align: center">corim.Entity</td><td style="text-align: center">corim.ExtEntity</td><td style="text-align: center">corim.Entity</td><td style="text-align: center">Usually indirect via myCorim.RegisterExtensions(...).</td></tr>
<tr><td style="text-align: center">corim.Signer</td><td style="text-align: center">corim.ExtSigner</td><td style="text-align: center">corim.Signer</td><td style="text-align: center">Usually indirect via myCorim.RegisterExtensions(...).</td></tr>
</tbody></table>
</div>
<p>Note that <code>comid.Mval</code> and <code>comid.FlagsMap</code> are used for both reference values
and endorsed values, which may be extended separately. This is why there are
two extension points associated with each. Additionally, <code>comid.ExtMval</code> and
<code>comid.ExtFlags</code> also exist when you want to register extensions with a
<code>comid.Mval</code> or <code>comid.Measurment</code> (and so don't have the context of whether it
will be going into a reference or an endorsed value).</p>
<p>The diagram below shows a visual representation of where these extension points
originate in the <code>struct</code> hierarchy, and which CoRIM object are "aware" of
which extension points:</p>
<p><img src="https://github.com/veraison/corim/raw/main/extensions/corim-map-extensions.png?" alt="map extensions" /></p>
<p>(note: the diagram shows the logical relationships between structures and does
not meant to accurately reflect the code -- e.g. it omits the container types,
representing them as slices)</p>
<p>To extend the above types, you need to define a struct containing your
extensions for each extension point that you want to extend. You then need to
create an <code>extensions.Map</code> that maps the extension points to a pointer to an
instance of the corresponding struct. Finally, you need to pass  the map to the
<code>RegisterExtensions()</code> method of an instance of the top-most type that is being
extended. For example, if you want to extend the comid, reference values, and
entities, you would create a struct defining the extensions for each, call
<code>extensions.NewMap()</code> to create a new map, call <code>Add()</code> on the map to add
mappings from the three extension points to pointers to empty instances of your
structs, and, finally, pass the map to <code>comid.Comid.RegisterExtensions()</code>. This
should be done as early as possible, before any marshaling is performed (see
the example below).</p>
<p>These types can be extended in two ways: by adding additional fields, and by
introducing additional constraints over existing fields.</p>
<h3 id="adding-new-fields"><a class="header" href="#adding-new-fields">Adding new fields</a></h3>
<p>To add new fields, simply add them to your extensions struct, ensuring that
the <code>cbor</code> and <code>json</code> tags on those fields are set correctly. As CoRIM
mandates integer keys, you must use the <code>keyasint</code> option for the <code>cbor</code> tag.</p>
<p>To access the values of those fields, you can call the extended type instance's
<code>Extensions.Get()</code> passing in the name of the field you want to access. The
name can be either the Go struct's field name, the name specified in the <code>json</code>
tag, or (a string containing) the integer specified in the <code>cbor</code> tag.</p>
<p><code>Get()</code> returns an <code>interface{}</code>. There are equivalent <code>GetInt()</code>,
<code>GetString()</code>, etc. methods that perform the required conversions, and return
the value of the indicated type, along with possible errors. ("Must" versions
of these also exist, e.g. <code>MustGetString()</code>, that do not return an error and
instead call <code>panic()</code>).</p>
<p>You can also get the pointer to your extension's instance itself by calling
the extended type instance's <code>GetExtensions()</code>. This returns an <code>interface{}</code>, so
you will need to type assert to be able to access the fields directly.</p>
<h3 id="introducing-additional-constraints"><a class="header" href="#introducing-additional-constraints">Introducing additional constraints</a></h3>
<p>To introduce new constraints, add a method called <code>Constrain&lt;TYPE&gt;(v *&lt;TYPE&gt;)</code>
to your extensions struct, where <code>&lt;TYPE&gt;</code> is the name of the type being
extended (one of the ones listed above) -- e.g.
<code>ConstrainComid(v *comid.Comid)</code> when extending <code>comid.Comid</code>. This method, if
it exists, will be invoked inside the extended type instance's <code>Valid()</code>
method, passing itself as the parameter.</p>
<p>You do not need to define this method unless you actually want to enforce some
constraints (i.e., if you just want to define additional fields).</p>
<h3 id="example-2"><a class="header" href="#example-2">Example</a></h3>
<p>The following example illustrates how to implement a map extension by extending
<code>comid.Entity</code> with the following features:</p>
<ol>
<li>an optional "email" field</li>
<li>additional constraint on the existing "name" field that it contains a
valid UUID (note: since <code>NameEntry</code> is a type choice extensible, this can
also be done by defining a new value type for <code>NameEntry</code> -- see the
following section).</li>
</ol>
<pre><code class="language-go">package main

import (
	"encoding/json"
	"fmt"
	"log"

	"github.com/google/uuid"
	"github.com/veraison/corim/comid"
	"github.com/veraison/corim/extensions"
)

// the struct containing the extensions
type EntityExtensions struct {
    // a string field extension
	Email string `cbor:"-1,keyasint,omitempty" json:"email,omitempty"`
}

// custom constraints for Entity
func (o EntityExtensions) ConstrainEntity(val *comid.Entity) error {
	_, err := uuid.Parse(val.EntityName.String())
	if err != nil {
		return fmt.Errorf("invalid UUID: %w", err)
	}

	return nil
}

var sampleText = `
{
      "name": "31fb5abf-023e-4992-aa4e-95f9c1503bfa",
      "regid": "https://acme.example",
      "email": "info@acme.com",
      "roles": [
        "tagCreator",
        "creator",
        "maintainer"
      ]
}
`

func main() {
	var entity comid.Entity
	extMap := extensions.NewMap().Add(comid.ExtEntity, &amp;EntityExtensions{})
	entity.RegisterExtensions(extMap)

	if err := json.Unmarshal([]byte(sampleText), &amp;entity); err != nil {
		log.Fatalf("ERROR: %s", err.Error())
	}

	if err := entity.Valid(); err != nil {
		log.Fatalf("failed to validate: %s", err.Error())
	} else {
		fmt.Println("validation succeeded")
	}

	// obtain the extension field value via a generic getter
	email := entity.Extensions.MustGetString("email")
	fmt.Printf("entity email: %s\n", email)

	// retrive the extensions struct and get value via its field.
	exts := entity.GetExtensions().(*EntityExtensions)
	fmt.Printf("also entity email: %s\n", exts.Email)
}
</code></pre>
<h3 id="profiles"><a class="header" href="#profiles">Profiles</a></h3>
<p>Map extensions may be grouped into profiles. A profile is registered,
associating an <code>eat.Profile</code> with an <code>extensions.Map</code>. A registered profile can
be obtained by calling <code>corim.GetProfileManifest()</code>, which returns a <code>corim.ProfileManifest</code>
object which can be used to obtain <code>corim.UnsignedCorim</code>, <code>corim.SignedCorim</code>
and <code>comid.Comid</code> instances that have the associated extensions registered.
<code>corim.UnmarshalUnsignedCorimFromCBOR()</code> will automatically look up a
registered profile based on the <code>eat.Profile</code> in the provided data (there are
corresponding functions for JSON and signed CoRIM).</p>
<pre><code class="language-go">// define extensions
type EntityExtensions struct {
	Address *string `cbor:"-1,keyasint,omitempty" json:"address,omitempty"`
}

type RefValExtensions struct {
	Timestamp *int `cbor:"-1,keyasint,omitempty" json:"timestamp,omitempty"`
}


// register profile
func init() {
	profileID, err := eat.NewProfile("http://example.com/example-profile")
	if err != nil {
		panic(err) // will not error, as the hard-coded string above is valid
	}

	extMap := extensions.NewMap().
		Add(comid.ExtEntity, &amp;EntityExtensions{}).
		Add(comid.ExtReferenceValue, &amp;RefValExtensions{})

	if err := RegisterProfile(profileID, extMap); err != nil {
		// will not error, assuming our profile ID is unique, and we've
		// correctly set up the extensions Map above
		panic(err)
	}
}


// use the profile
func main() {
	buf, err := os.ReadFile("testcases/unsigned-example-corim.cbor")
	if err != nil {
		log.Fatalf("could not read corim file: %v", err)
	}

	// UnmarshalUnsignedCorimFromCBOR will detect the profile and ensure
	// the correct extensions are loaded before unmarshalling
	extractedCorim, err := UnmarshalUnsignedCorimFromCBOR(buf)
	if err != nil {
		log.Fatalf("could not unmarshal corim: %v", err)
	}

    // ...
}

</code></pre>
<p>Please see <a href="../corim/example_profile_test.go">example_profile_test.go</a> for the complete
example of creating and using CoRIM profiles.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Currently, only map extensions can be associated with profiles. Type choice
and enum value extensions (described below) can only be registered globally.</p>
</div>
<h2 id="type-choice-extensions"><a class="header" href="#type-choice-extensions">Type Choice Extensions</a></h2>
<p>Type Choice extensions allow specifying alternative types for existing CoRIM
fields by defining a type that implements an appropriate interface and
registering it with a CBOR tag.</p>
<p>A type choice struct contains a single field, <code>Value</code>, that contains the actual
object represented by the type choice. The <code>Value</code> implements an interface
that is specific to the type choice and is derived from <code>ITypeChoiceValue</code>:</p>
<pre><code class="language-go">type ITypeChoiceValue interface {
	// String returns the string representation of the ITypeChoiceValue.
	String() string
	// Valid returns an error if validation of the ITypeChoiceValue fails,
	// or nil if it succeeds.
	Valid() error
	// Type returns the type name of this ITypeChoiceValue implementation.
	Type() string
}
</code></pre>
<p>The following is the full list of type choice structs:</p>
<ul>
<li><code>comid.ClassID</code></li>
<li><code>comid.CryptoKey</code></li>
<li><code>comid.EntityName</code></li>
<li><code>comid.Group</code></li>
<li><code>comid.Instance</code></li>
<li><code>comid.Mkey</code></li>
<li><code>comid.SVN</code></li>
<li><code>corim.EntityName</code></li>
</ul>
<p>To provide a new value type, the following is required:</p>
<ol>
<li>Define a type that implements the value interface for the type choice you
want to extend. This interface is called <code>I&lt;NAME&gt;Value</code>,  where <code>&lt;NAME&gt;</code> is
the name of the type choice type(e.g. <code>IClassIDValue</code>).  These interfaces
always embed <code>ITypeChoiceValue</code> and possibly define additional methods.</li>
<li>Create a factory function for your type, with the signature <code>func (any) (*&lt;NAME&gt;, error)</code>, where <code>&lt;NAME&gt;</code> is the name of the type choice type that
will contain your value. (Note that the function must return a pointer to
the container type choice struct, <em>not</em> to the value type you define.) This
function should create an instance of your value type from the provided
input and return a new type choice struct instance containing it. The range
of valid inputs is up to you, however it <em>must</em> handle <code>null</code>, returning the
<a href="https://go.dev/ref/spec#The_zero_value">zero-value</a> for your type in that
case.</li>
<li>Register your factory function with the CBOR tag for your new type by
passing it to the registration function corresponding to the type choice
struct. It will have the name <code>Register&lt;NAME&gt;Type</code>, where <code>&lt;NAME&gt;</code> is the
name of the type choice struct that will contain your value (e.g.
<code>RegisterClassIDType</code>).</li>
</ol>
<h3 id="example-3"><a class="header" href="#example-3">Example</a></h3>
<p>The following example illustrates how to add a new type choice value
implementation by extending the <code>CryptoKey</code> type to support DER values.</p>
<pre><code class="language-go">package main

import (
	"crypto"
	"crypto/x509"
	"encoding/base64"
	"encoding/json"
	"errors"
	"fmt"
	"log"

	"github.com/veraison/corim/comid"
)

// the CBOR tag to be used for the new type
var DerKeyTag = uint64(9999)

// new implementation of ICryptoKeyValue type
type TaggedDerKey []byte

// The factory function for the new type
func NewTaggedDerKey(k any) (*comid.CryptoKey, error) {
	var b []byte
	var err error

	if k == nil {
		k = *new([]byte)
	}

	switch t := k.(type) {
	case []byte:
		b = t
	case string:
		b, err = base64.StdEncoding.DecodeString(t)
		if err != nil {
			return nil, err
		}
	default:
		return nil, fmt.Errorf("value must be a []byte; found %T", k)
	}

	key := TaggedDerKey(b)

	return &amp;comid.CryptoKey{Value: key}, nil
}

func (o TaggedDerKey) String() string {
	return base64.StdEncoding.EncodeToString(o)
}

func (o TaggedDerKey) Valid() error {
	_, err := o.PublicKey()
	return err
}

func (o TaggedDerKey) Type() string {
	return "pkix-der-key"
}

func (o TaggedDerKey) PublicKey() (crypto.PublicKey, error) {
	if len(o) == 0 {
		return nil, errors.New("key value not set")
	}

	key, err := x509.ParsePKIXPublicKey(o)
	if err != nil {
		return nil, fmt.Errorf("unable to parse public key: %w", err)
	}

	return key, nil
}

var testKeyJSON = `
{
	"type": "pkix-der-key",
	"value": "MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEW1BvqF+/ry8BWa7ZEMU1xYYHEQ8BlLT4MFHOaO+ICTtIvrEeEpr/sfTAP66H2hCHdb5HEXKtRKod6QLcOLPA1Q=="
}
`

func main() {
    // register the factory function under the CBOR tag.
	if err := comid.RegisterCryptoKeyType(DerKeyTag, NewTaggedDerKey); err != nil {
		log.Fatal(err)
	}

	var key comid.CryptoKey

	if err := json.Unmarshal([]byte(testKeyJSON), &amp;key); err != nil {
		log.Fatal(err)
	}

	fmt.Printf("Decoded DER key: %x\n", key)
}
</code></pre>
<h2 id="enum-extensions"><a class="header" href="#enum-extensions">Enum extensions</a></h2>
<p>The following enum types may be extended with additional values:</p>
<ul>
<li><code>comid.Rel</code></li>
<li><code>comid.Role</code></li>
<li><code>corim.Role</code></li>
</ul>
<p>This can be done by calling <code>RegisterRel</code> or <code>RegisterRole</code>, as appropriate,
and providing a new <code>uint64</code> value and corresponding <code>string</code> name.</p>
<h3 id="example-4"><a class="header" href="#example-4">Example</a></h3>
<pre><code class="language-go">package main

import (
	"encoding/json"
	"fmt"
	"log"

	"github.com/veraison/corim/comid"
)

var sampleText = `
{
      "name": "Acme Ltd.",
      "regid": "https://acme.example",
      "roles": [
        "tagCreator",
        "owner"
      ]
}
`

func main() {
    // associate role value 4 with the name "owner"
	comid.RegisterRole(4, "owner")

	var entity comid.Entity

	if err := json.Unmarshal([]byte(sampleText), &amp;entity); err != nil {
		log.Fatalf("ERROR: %s", err.Error())
	}

	if err := entity.Valid(); err != nil {
		log.Fatalf("failed to validate: %s", err.Error())
	} else {
		fmt.Println("validation succeeded")
	}

	fmt.Println("roles:")
	for _, role := range entity.Roles {
		fmt.Printf("\t%s\n", role.String())
	}
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="attestation-results"><a class="header" href="#attestation-results">Attestation Results</a></h1>
<p>Attestation results produced by <a href="services/overview.html">Remote Attestation
Services</a> are in <a href="https://datatracker.ietf.org/doc/draft-fv-rats-ear/">EAT Attestation
Result</a> (EAR) format.</p>
<p>There is library support for working with EARs available for
<a href="https://github.com/veraison/ear">Go</a>,
<a href="https://github.com/veraison/rust-ear">Rust</a>,
<a href="https://github.com/veraison/c-ear">C</a>, and
<a href="https://github.com/veraison/python-ear">Python</a> languages.</p>
<p>At the core of an EAR is a Trust Vector defined by <a href="https://datatracker.ietf.org/doc/draft-ietf-rats-ar4si/">AR4SI IETF
Draft</a>, which breaks
down the appraisal of attestation evidence into eight categories (a
particular <a href="services/schemes/overview.html">Attestation Scheme</a> may not utilize
all of the categories).</p>
<p>EARs maybe serialised as either <a href="https://www.ietf.org/rfc/rfc7519.html">JWT</a> or
<a href="https://www.ietf.org/rfc/rfc9052.html">COSE</a> messages (<a href="services/overview.html">Remote Attestation
Services</a> produces results as JWT only).</p>
<h2 id="example-attestation-result"><a class="header" href="#example-attestation-result">Example attestation result</a></h2>
<p>This is JSON serialization of a sample attestation result as produced by
<a href="services/overview.html">Remote Attestation Services</a> for Arm PSA evidence.</p>
<pre><code class="language-json">{
    "ear.status": "affirming",
    "ear.trustworthiness-vector": {
      "instance-identity": 2,
      "configuration": 0,
      "executables": 2,
      "file-system": 0,
      "hardware": 2,
      "runtime-opaque": 2,
      "storage-opaque": 2,
      "sourced-data": 0
    },
    "ear.appraisal-policy-id": "policy:PSA_IOT",
    "ear.veraison.annotated-evidence": {
      "eat-profile": "http://arm.com/psa/2.0.0",
      "psa-client-id": 1,
      "psa-security-lifecycle": 12288,
      "psa-implementation-id": "YWNtZS1pbXBsZW1lbnRhdGlvbi1pZC0wMDAwMDAwMDE=",
      "psa-boot-seed": "3q2+796tvu/erb7v3q2+796tvu/erb7v3q2+796tvu8=",
      "psa-software-components": [
        {
          "measurement-type": "BL",
          "measurement-value": "h0KPxSKAPTEGXnvOPPA/5HUJZjHl4Hu9eg/eYMTPJcc=",
          "signer-id": "rLsRx+TaIXIFUjzkzhokWuGiOa48a/2eeHH35di66Gs=",
          "version": "2.1.0"
        },
        {
          "measurement-type": "PRoT",
          "measurement-value": "AmOCmYm2/ZVPcrqvL8ZLwuLwHWktTecphuqAj26ZgT8=",
          "signer-id": "rLsRx+TaIXIFUjzkzhokWuGiOa48a/2eeHH35di66Gs=",
          "version": "1.3.5"
        },
        {
          "measurement-type": "ARoT",
          "measurement-value": "o6XnFfDMV0pzw/m+u2vCTzL/1bZ7OHJEwskJ2neaFHg=",
          "signer-id": "rLsRx+TaIXIFUjzkzhokWuGiOa48a/2eeHH35di66Gs=",
          "version": "0.1.4"
        }
      ],
      "psa-instance-id": "Ac7rrnuJJ6MiflMDz14PH3s0u1Qq1yUKwD+83jbsLxUI",
      "psa-verification-service-indicator": "https://psa-verifier.org",
      "psa-nonce": "QUp8F0FBs9DpodKK8xUg8NQimf6sQAfe2J1ormzZLxk="
    }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="endorsement-distribution-api"><a class="header" href="#endorsement-distribution-api">Endorsement Distribution API</a></h1>
<p>This musing discusses the addition of a new Veraison service that provides an <a href="https://wiki.ietf.org/en/group/rats/referencevalues">Endorsement Distribution API</a> endpoint.</p>
<p>In the reminder of this musing, we will use the shorthand "EAPI" to refer to this new service.</p>
<h2 id="simplifying-assumptions"><a class="header" href="#simplifying-assumptions">Simplifying Assumptions</a></h2>
<p>At this stage, this work is intended as a proof-of-concept, therefore we will make a few simplifying assumptions:</p>
<ol>
<li>Arm CCA only</li>
<li>Simplified RBAC model with fixed tenant</li>
<li>Transactional (request-response) API</li>
</ol>
<ul>
<li>All responses will be "full" in the PoC: we won't try to exemplify any kind of fine-grained partial patching of data.</li>
<li>The client is expected to perform a periodic fetch to refresh its local cache.</li>
</ul>
<ol start="4">
<li>API output in <a href="https://github.com/veraison/rust-ccatoken/blob/main/src/store/data-model.cddl">rust-ccatoken</a> format</li>
</ol>
<ul>
<li>The output format will generally depend on the attestation scheme. In the prototype, the Arm CCA scheme identifier will be included during the API negotiation process. Any other scheme identifier will result in a failure.</li>
</ul>
<p>These choices minimise the amount of new client code required while still creating many of the necessary building blocks on the server side.</p>
<h2 id="new-bits-and-pieces"><a class="header" href="#new-bits-and-pieces">New bits and pieces</a></h2>
<p>EAPI will be added as a new service alongside the existing <a href="https://github.com/veraison/services/tree/main/verification">verification</a>, <a href="https://github.com/veraison/services/tree/main/management">management</a> and <a href="https://github.com/veraison/services/tree/main/provisioning">provisioning</a> components.</p>
<p>Strictly speaking, EAPI depends only on <a href="https://github.com/veraison/services/tree/main/vts">VTS</a> (Veraison trusted services) which is the exclusive owner of the stores from which the endorsements are fetched.
EAPI is likely to execute in combination with the provisioning service, which allows ingesting up-to-date endorsements from "upstream" endorsers and reference value providers via its push API.
In an EAPI-driven deployment, the verification service can be muted.
(Full blown RBAC support will need integration with KeyCloak; this can be deferred to a later stage.)</p>
<p>EAPI exposes a REST API endpoint over HTTPS that allows a client to retrieve "endorsements" (i.e., reference values and trust anchors) pertaining to a given attester ((A) in the figure below.)</p>
<p>Since the endorsement stores are owned by the VTS component, one or more <a href="https://github.com/veraison/services/blob/main/proto/vts.proto">gRPC services</a> (B) need to be defined to allow EAPI to query the stores (C) through VTS.
Their exact shape will be driven by the interface offered by the external REST API.</p>
<p>VTS will be extended to receive the query via the new gRPC service, create the corresponding query (or queries) to the stores and forward the result set back to EAPI.
EAPI will repackage the results according to the REST spec and send them in the HTTP response to the client.</p>
<p>If needed, scheme-specific query adapters will be encapsulated in a "EAPI query plugin" (D).</p>
<pre><code>.--------.            .------.     .-----.     .--------.
| Vfying |            |      |     |     |     |'------'|
| RP     +----o )-----+ EAPI +-----+ VTS +-----+ Stores |
|        |        (A) |      | (B) |     | (C) |        |
'--------'            '------'     '--+--'     '--------'
                                      | (D)
                                  .---+---.
                                  |query  |
                                  |plugin |
                                  '-------'
</code></pre>
<h2 id="attester-identification"><a class="header" href="#attester-identification">Attester Identification</a></h2>
<p>When requesting endorsements for a specific target or attesting environment, the client must provide an identifier for that environment.
These identifiers are specific to the attestation scheme being used.</p>
<p>A suitable data model for encapsulating different identifiers is the <a href="https://www.ietf.org/archive/id/draft-ietf-rats-corim-06.html#section-5.1.4.1"><code>environment-map</code></a> from CoRIM.</p>
<p>This prototype will utilize the <code>environment-map</code> along with an attestation scheme identifier to supply the necessary query parameters:</p>
<ul>
<li>The attestation scheme identifier is used to locate the right "query plugin".</li>
<li>The <code>environment-map</code> is treated as opaque data until it reaches the intended plugin, where it's interpreted and mapped to a suitable KV-store key for lookup.</li>
</ul>
<p>Which schemes are supported in the prototype (Arm CCA only), and which attester identification data model (CoRIM’s <code>environment-map</code>) will be exposed via a discovery resource at <code>.well-known/veraison/endorsement-distribution</code></p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="rats-conceptual-message-collection-daemon"><a class="header" href="#rats-conceptual-message-collection-daemon">RATS Conceptual Message Collection Daemon</a></h1>
<p>See <a href="https://github.com/veraison/ratsd/tree/main">GitHub</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/pagetoc.js"></script>
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </div>
    </body>
</html>
